---
title: "Examining Social Inequities in Traffic-Related Air Pollution Disparities in the Seattle Metropolitan Area Using Predictive Modeling"
author: "Mariana Cortes Espinosa, Cecilia Martindale, Stephanie Mitchell, Jorge Rivera-Gonzalez, Katelin Teigen"
output: 
  html_document:
    df_print: "paged"
    fig_caption: yes
    toc: true
    toc_float: true
    toc_collapsed: true
    self-contained: true #save images etc. in this file (vs folders)
    toc_depth: 3
date: "2024-12-10"
execute:
  echo: false
  warning: false
  tidy: false
  tidy-options:
    width.cutoff: 80
    blank: false
  cache: false
  message: false
editor_options: 
  chunk_output_type: console
---

# Background

Traffic-related air pollution (TRAP) is an environmental pollutant and is a dominant contributor to urban air quality challenges. Nitrogen dioxide (NO₂) and fine particulate matter (PM2.5) are two major components of TRAP, which are both regulated at the ambient level under the Clean Air Act (Clean Air Act Amendments of 1990, 1990). The act gives the U.S. Environmental Protection Agency (EPA) the authority to establish national standards for six criteria air pollutants, all documented to adversely affect health (U.S. Environmental Protection Agency, 2013). PM2.5 exposure specifically has been linked to health effects ranging from airway irritation and aggravation of asthma symptoms to premature death in those with pre-existing cardiovascular or respiratory diseases (Particulate Matter (PM), 2016). NO₂ has been linked to similar health effects, alongside contributing to the development of asthma and greater susceptibility to respiratory infections (Nitrogen Dioxide (NO2), 2016).

Higher levels of TRAP characterize urban cities such as the greater Seattle metropolitan area, yet monitoring of these pollutants is limited by the low spatial resolution provided by the few federal regulatory air monitors in the area. This is an issue when characterizing and predicting accurate exposure levels to air pollutants at a finer spatial scale. Public concern about air pollution and its impact on human health has grown significantly, especially for socially and economically marginalized communities who disproportionately bear environmental health risks, such as elevated exposure to air pollution (Hong & Jee, 2020; Loopmans et al., 2022).

In Seattle, historical segregation, driven by practices like redlining, established a foundation for these inequities. Marginalized groups, often living near major roadways and transportation hubs, face heightened pollution exposure (Bramble et al., 2023; Clark et al., 2017). Segregation in Seattle initially targeted Asian Americans, who were confined to Chinatown until its demolition in 1886, forcing many to leave the city (Gregory, n.d.). By the mid-20th century, segregation laws, deed restrictions, and racially exclusive housing clauses confined Black, Asian, and Jewish residents to specific areas, further reinforced by systemic housing discrimination (Gregory, n.d.). Today, housing affordability has worsened these inequities, with median home prices in Seattle nearly seven times the median household income, double the 1990 home to income ratio (Groover, 2024).

Historical patterns of segregation, systemic discrimination, and economic inequities have disproportionately subjected marginalized communities in Seattle to elevated exposure to harmful traffic-related air pollution (TRAP). This environmental injustice issue, compounded by income inequality and limited access to affordable housing, highlights the continued need to promote equitable outcomes. This study aims to expand upon the analysis conducted by Bramble et al., which explored exposure disparities related to income, race, and historic redlining through the application of air pollutant concentrations collected via a recent mobile monitoring campaign (Bramble et al., 2023). TRAP levels in the Seattle metropolitan area were recently characterized in a spatiotemporally balanced year-long mobile monitoring campaign for the purposes of assessing exposure levels for the Adult Changes in Thought (ACT) study (M. N. Blanco et al., 2022). For this study, we use these pollutant measurements and geographic covariates linked to each monitoring location alongside sociodemographic characteristics from the 2019 U.S. American Community Survey (ACS) at the census tract level, including racial demographics, poverty rates, and language diversity statistics, rather than Home Owners’ Loan Corporation (HOLC) grades and income metrics used in Bramble et al. 2023.

This study aims to evaluate how historically marginalized communities in the Seattle metropolitan area—those impacted by systemic policies such as redlining, housing discrimination, and proximity to major roadways—experience disproportionately high exposure to TRAP, specifically PM2.5 and NO2. Leveraging high-resolution mobile monitoring data, land-use covariates, and updated sociodemographic information from the U.S. Census, this research seeks to characterize spatial variability in pollutant concentrations and assess associations between predicted pollutant levels and sociodemographic factors, including income, race/ethnicity, and language diversity. Building on prior research (e.g., (M. N. Blanco et al., 2022; Bramble et al., 2023; Mercer et al., 2011)), this study combines simplified prediction models with robust geostatistical methods to assess disparities in air pollution exposure. Ultimately, these findings aim to inform public health interventions and urban planning strategies to reduce exposure disparities and promote equitable outcomes in air quality management.

```{r, include=FALSE}
knitr::opts_chunk$set(echo=FALSE, message=FALSE)
```

```{r setup}
# Clear workspace of all objects and unload non-base packages
rm(list = ls(all = TRUE))
if (!is.null(sessionInfo()$otherPkgs)) {
    suppressWarnings(
        lapply(paste('package:', names(sessionInfo()$otherPkgs), sep=""),
               detach, character.only=TRUE, unload=TRUE, force=TRUE)
    )
}

# Load or install 'pacman' for package management
my_repo <- 'http://cran.r-project.org'
if (!require("pacman")) {
    install.packages("pacman", repos = my_repo)
}

# **SPH server**: need to install rnaturalearthhires like so on the SPH server
if (!require("rnaturalearthhires")) {
    install.packages("rnaturalearthhires", repos = "https://ropensci.r-universe.dev", type = "source")
}

pacman::p_load(
    tidyverse,                 
    biscale,
    broom,
    ggspatial,                  
    maptiles,  
    terra, 
    prettymapr,
    
    rnaturalearth,             
    rnaturalearthhires,        
    sf,                        
    knitr,                     
    gstat,                    
    Hmisc,                    
    scales,                    
    akima,                     
    downloader,                
    tigris,
    RColorBrewer,
    scales,
    kableExtra, patchwork
)

```

```{r load.data, include=FALSE}

annual_data <- read_csv("annual_data_and_predictions.csv")

census_shapefile <- st_read("cb_2019_53_tract_500k.shp")

grid_covariates <- read_csv("dr0311_grid_covariates.csv")

mobile_covariates <- read_csv("dr0311_mobile_covariates.csv")

stop_data <- read_csv("stop_data.csv")

acs_race <- read_csv("ACS19_race.csv")

acs_ethnicity <- read_csv("ACS19_ethnicity.csv")

acs_language <- read_csv("ACS19_language.csv")

acs_median_income <- read_csv("ACS19_median_income.csv")

acs_poverty <- read_csv("ACS19_poverty.csv")

census_blocks_covar <- read_csv("wa_block_covar_clean.csv")
```

```{r data.cleaning, include=FALSE}
# annual data
table(annual_data$variable)

#create variable to differentiate between stop site and collocation site
annual_data <- annual_data %>% 
  mutate(SiteType = ifelse(grepl("MS", location), "stop site",
                       ifelse(grepl("MC", location), "collocation site", NA)))

# keep only NO2 and PM
annual_clean <- annual_data %>% 
  filter(variable == "no2" | variable == "pm2.5_ug_m3") %>%
  filter(SiteType == "stop site") %>% 
  select(-c(annual, SiteType))


# stop data
#create variable to differentiate between stop site and collocation site
stop_data <- stop_data %>% 
  mutate(SiteType = ifelse(grepl("MS", location), "stop site",
                       ifelse(grepl("MC", location), "collocation site", NA)))

stop_clean <- stop_data %>% 
  filter(variable == "no2" | variable == "neph_bscat") %>%
  filter(SiteType == "stop site") %>% 
  select(c(runname, time, location, stop_id, instrument_id, variable, mean_value, median_value))   

# Get location coordinates
stop_coords <- annual_clean %>% select(c("location", "longitude", "latitude")) %>%
  unique()

stop_clean <- stop_clean %>% 
  filter(median_value > 0) %>% 
  mutate(log_mean = log(mean_value)) %>% 
  mutate(log_median = log(median_value)) %>% 
  filter(log_median > 0) %>% 
  left_join(stop_coords)

# Generate NO2 specific dataset
no2_stop_clean <- stop_clean %>%
  filter(variable == "no2")

# Generate PM2.5 specific dataset
pm25_stop_clean <- stop_clean %>% 
  filter(variable == "neph_bscat")


# census data
table(census_shapefile$COUNTYFP) # there are 39 counties, we don't need them all 
# only keep King (033), Snohomish (061), Pierce (053), Kitsap (035)
# get rid of LSAD and STATEFP since they are all the same
census_clean <- census_shapefile %>%
  filter(COUNTYFP %in% c("033", "061", "053", "035")) %>%
  select(-c(LSAD,STATEFP)) %>% 
  st_as_sf()

# grid covar
# create 6 digit TRACTCE var that matches census shapefile var
# log-transform distance covariates
grid_covar_clean <- grid_covariates %>%
  mutate(TRACTCE = substr(as.character(tract_key), 
            nchar(as.character(tract_key)) - 5, nchar(as.character(tract_key)))) %>%
  select(c(location_id, native_id, tract_key, m_to_a1, m_to_a2, m_to_a3, pop10_s05000, m_to_coast, m_to_l_airp, m_to_comm,lu_industrial_p03000, longitude, latitude)) %>%
  mutate(log_m_to_a1 = log(m_to_a1 + 1), log_m_to_a2=log(m_to_a2 +1),
         log_m_to_a3=log(m_to_a3+1),
         log_m_to_coast=log(m_to_coast+1), log_m_to_l_airp=log(m_to_l_airp+1), 
         log_m_to_comm=log(m_to_comm+1)) %>% 
  select(-c(m_to_a1,m_to_a2,m_to_a3,m_to_coast,m_to_l_airp,m_to_comm))

# mobile covar
# create 6 digit TRACTCE var that matches census shapefile var
mobile_covar_clean <- mobile_covariates %>%
  mutate(TRACTCE = substr(as.character(tract_key), 
            nchar(as.character(tract_key)) - 5, nchar(as.character(tract_key)))) %>%
  select(c(location_id, native_id, tract_key, TRACTCE, m_to_a1, m_to_a2, m_to_a3, pop10_s05000, m_to_coast, m_to_l_airp, m_to_comm,lu_industrial_p03000)) %>%
  mutate(log_m_to_a1 = log(m_to_a1+1), log_m_to_a2=log(m_to_a2+1), log_m_to_a3=log(m_to_a3+1),
         log_m_to_coast=log(m_to_coast+1), log_m_to_l_airp=log(m_to_l_airp+1), 
         log_m_to_comm=log(m_to_comm+1)) %>% 
  select(-c(m_to_a1,m_to_a2,m_to_a3,m_to_coast,m_to_l_airp,m_to_comm))

# create dataset with stop and mobile data combined
stop_and_mobile <- merge(stop_clean, mobile_covar_clean,
                       by.x = "location", by.y = "native_id", 
                       all = FALSE)

# Join with census_clean
stop_mobile_census <- census_clean %>%
  inner_join(stop_and_mobile, by = "TRACTCE") %>% 
  select(c(TRACTCE, location, time, variable, mean_value, median_value, pop10_s05000, lu_industrial_p03000, log_m_to_a1, log_m_to_a2, log_m_to_a3, log_m_to_coast, log_m_to_l_airp, log_m_to_comm, geometry))


# acs race data
# create 6 digit TRACTCE var that matches census shapefile var
acs_race_clean <- acs_race %>%
  mutate(TRACTCE = substr(as.character(GEO_ID), 
            nchar(as.character(GEO_ID)) - 5, nchar(as.character(GEO_ID))))

# acs ethnicity data
# create 6 digit TRACTCE var that matches census shapefile var
acs_ethnicity_clean <- acs_ethnicity %>%
  mutate(TRACTCE = substr(as.character(GEO_ID), 
            nchar(as.character(GEO_ID)) - 5, nchar(as.character(GEO_ID))))

# acs language data
# create 6 digit TRACTCE var that matches census shapefile var
acs_language_clean <- acs_language %>%
  mutate(TRACTCE = substr(as.character(GEO_ID), 
            nchar(as.character(GEO_ID)) - 5, nchar(as.character(GEO_ID))))

```

```{r data.cleaning.census.blocks}
###how I got the unique tracts for cleaning the wa blocks
# unique_tracts <- as.data.frame(unique(grid_covar_clean$tract_key))
# write_csv(unique_tracts, "unique_tracts.csv")

# filter census block centroids so that it only contains centroids for the tracts in the grid

census_blocks_covar_clean <- census_blocks_covar %>%
  mutate(log_m_to_a1 = log(m_to_a1+1), log_m_to_a2=log(m_to_a2+1), log_m_to_a3=log(m_to_a3+1),
         log_m_to_coast=log(m_to_coast+1), log_m_to_l_airp=log(m_to_l_airp+1), 
         log_m_to_comm=log(m_to_comm+1)) %>% 
  select(-c(m_to_a1,m_to_a2,m_to_a3,m_to_coast,m_to_l_airp,m_to_comm)) %>%
  filter(tract_key %in% mobile_covar_clean$tract_key)

```

```{r merge.acs.files}
# merge and clean language, race, ethnicity and poverty datasets
# filter out the water census tracts, cleaned up NAs
acs_combined <- reduce(
  list(acs_language_clean, acs_race_clean, acs_ethnicity_clean, acs_poverty),
  function(x, y) merge(x, y, by = c("GEO_ID", "NAME"), all = TRUE)
) %>% filter(Total_Pop_5yrsplus!=0)
#colnames(acs_combined)


#NOTE: Variables dropped from this merge: dropped 2ormore column due to complications with code running and to simplify demographics, dropped non-hispanic or latino since it was redundant and we have a "yes" column for hispanic or latino; also removed total_pop_5yearsplus since it is a variable for children over age 5 and did not seem relevant to our questions
acs_simplified <- acs_combined %>%
  select(
    GEO_ID, NAME, TRACTCE, English_only, Language_other_than_English,
    Spanish, Indo_European, Asian_PI, Other, White, Black_AfricanAmerican,
    AIAN, Asian, Hawaiian_PacificIslander, Other_alone, HispanicorLatino,
    Total_Pop, Total_Pop_ME, Percent_Below_Poverty, Percent_Below_Poverty_ME
  ) %>%
  mutate(
    Percent_Below_Poverty = as.numeric(Percent_Below_Poverty),
    Percent_Below_Poverty_ME = as.numeric(Percent_Below_Poverty_ME),
    tract_key = as.numeric(substr(as.character(GEO_ID), 
                                  nchar(as.character(GEO_ID)) - 10, 
                                  nchar(as.character(GEO_ID))))
  ) %>% #fixing incorrect Total_Pop for Pierce County tract 729.06
  mutate(Total_Pop=case_when(NAME=="Census Tract 729.06, Pierce County, Washington" ~ 1995,
                             .default=Total_Pop))

```

```{r merge.stop.and.acs.data}
# create stop data with land use vars and ACS (for descriptive tables)
# merge locations on location var variable (stop_clean) and native_id variable (mobile_covar)
# pre-merge stop_clean dim 17533 x 8, mobile_covar_clean dim 311 x 12
# want to make sure we end up with 17533 rows
# removed extraneous geographic/census vars
stop_w_acs <- left_join(stop_clean, mobile_covar_clean, join_by(location==native_id)) %>%
  left_join(acs_simplified, join_by(tract_key==tract_key)) %>%
  select(-c(GEO_ID))
#dim(stop_w_acs) 
# dimensions are correct (17533 rows)

# created stop data for use in regression for prediction
stop_for_preds <- stop_w_acs %>% select(c(time, location, instrument_id, variable,
                                          log_mean,
                                          mean_value, median_value, pop10_s05000,
                                          lu_industrial_p03000, log_m_to_a1, 
                                          log_m_to_a2, log_m_to_a3, log_m_to_coast,
                                          log_m_to_l_airp, log_m_to_comm, longitude, latitude))

# filter stop_for_preds into two different data sets, one for PM2.5 and one for NO2
pm_for_preds <- stop_for_preds %>% filter(variable == "neph_bscat")

no2_for_preds <- stop_for_preds %>% filter(variable == "no2")

annual_w_acs <- left_join(annual_clean, mobile_covar_clean, join_by(location==native_id)) %>%
  left_join(acs_simplified, join_by(tract_key==tract_key)) %>%
  select(-c(GEO_ID))

# created stop data for use in regression for prediction
annual_for_preds <- annual_w_acs %>% 
  mutate(log_value=log(value)) %>%
  select(c(location, variable, log_value, value, pop10_s05000, lu_industrial_p03000,
           log_m_to_a1, log_m_to_a2, log_m_to_a3, log_m_to_coast, log_m_to_l_airp,
           log_m_to_comm, longitude, latitude))

# create grid data with ACS (for predicting onto and answering Q2/3)
# should end with 5040 rows
 
acs_combined<- acs_combined %>% mutate(tract_key=as.numeric(substr(as.character(GEO_ID), 
            nchar(as.character(GEO_ID)) - 10, nchar(as.character(GEO_ID)))))

grid_w_acs <- left_join(grid_covar_clean, acs_combined, join_by(tract_key==tract_key)) %>%
  select(-c(GEO_ID, TRACTCE))

```

# Methods

## Data Description

This study utilized air quality data from a mobile monitoring campaign conducted in the greater Seattle region, focusing on PM2.5 and NO2 concentrations collected at 309 designated stop sites (M. N. Blanco et al., 2022). Pollutant concentrations, including PM2.5 (in µg/m³) and NO2 (in ppb) were measured from March 2019 to March 2020, spanning all seasons, days of the week, and at nearly all times of day, rendering about 29 2-minute temporally-balanced samples at each stop location. The annual average concentrations for each stop location were used to make our predictions. This data also included location data (longitude and latitude). The pollutant concentrations, land-use covariates, and Washington State census block centroids were accessed via the ACT-AP Mobile Monitoring open-access data directory (M. Blanco & Sheppard, 2024).

Land-use covariates were based on the stop locations, encompassing metrics such as proximity to roads, industrial areas, and airports. Land use covariates were selected based on their documented relevance in previous research, particularly Mercer et al., which highlights the influence of traffic and industrial sources on nitrogen oxide concentrations. To ensure consistency, the same land use covariates were applied to predict both average PM2.5 and NO2 concentrations. Land-use covariates were also obtained for the centroids of census blocks included in the study area.

Socio-demographic data at the census tract level were obtained from the 2019 ACS, including race, ethnicity, income, and language diversity variables (U.S. Census Bureau, n.d.). The dataset included census tracts from mostly western King County and southwestern Snohomish County, and tracts with zero population (i.e., those over bodies of water) were excluded. This study area includes a variety of both urban and rural localities with a range of land uses (e.g., industrial, commercial, and residential) (M. N. Blanco et al., 2022). Economic disparity was measured using the percentage of individuals below the federal poverty level (FPL). Additionally, language diversity was assessed using the percent of individuals who speak a language other than English at home, and whether this language was Spanish or another language. Racial demographics were represented as a percent of the total census tract population identifying as White, Black or African American, Asian, American Indian or Alaska Native, Native Hawaiian or Pacific Islander, or Hispanic or Latino. Analyzing demographics at the census tract level provides a neighborhood-like semi-comparable spatial scale in which population size is similar across tracts, which is ideal for analyzing environmental justice concerns such as disparities in air pollution exposure.

## Data Cleaning and Exploration

Census tracts with populations of zero were excluded and annual stop site data were filtered to retain only relevant pollutants: NO2 and PM2.5. The cleaned dataset included location of the data collection site, longitude, latitude, variable (PM2.5 or NO2), and mean value. Both pollutant distributions were examined and then log-transformed. Maps of NO2 and PM2.5 are presented on the native scale.

Socio-demographic variables from the ACS were integrated with the cleaned stop site data using census tract codes. Land use covariates were log-transformed to stabilize variance and improve interpretability. For example, log-transformed distances typically represent the decay of air pollutant levels from the source with increasing distance. Since some covariates included zero values, a constant value of one was added to each land use covariate prior to log-transformation to avoid indefinite computations. We used log-transformed distances as land use covariates to capture the expected exponential decay of air pollutant concentrations with increasing distance from the source, aligning the prediction model more closely with real-world dispersion processes.

Several maps were created to contextualize these socio-demographic patterns geographically. First, a map visualized the racial and ethnic composition of the study area by census tract, using an OpenStreetMap base map for spatial context. This map provides a detailed geographic understanding of demographic patterns across the study area. Language diversity was also visualized by the census tract in the study area. As the language diversity map took the smallest amount of memory, we included this map in the Appendix. These maps underscore the region's linguistic diversity and relevance to environmental justice concerns.

## Statistical Analysis

### Summary Statistics

For NO2 and PM2.5, descriptive statistics were calculated (arithmetic and geometric means and standard deviations (SD), median, minimum, and maximum), and observation counts per pollutant were summarized. These descriptive statistics describe the central tendency and distribution of the annual concentrations of each air pollutant for March 2019-March 2020 for the stop locations. To illustrate mobile monitoring locations and the distribution of air pollution concentrations, the annual mean concentrations of each pollutant at the stop locations were mapped. For the sociodemographic variables of race/ethnicity, income, and language diversity, mean percentages and total population counts per county and the total area covered by the study were reported. Only the census tracts that contained the stop sites were included.

### Prediction Models

For the prediction regression models, we selected the most similar GIS covariates to those used by Mercer et al. for PM2.5 and NO2 because of our interest in traffic-generated pollutants, which are a significant contributor to air quality impacts, particularly in urban environments ((M. N. Blanco et al., 2022; Bramble et al., 2023; Mercer et al., 2011)). The GIS covariates available to us were not exactly the same as Mercer et al., so we approximated them as closely as possible. The resulting covariates were distance from A1, A2, and A3 roads, distance to coast and commercial areas, population within 5000 meters in tens of thousands, and percent of industrial land use within a 3000-meter buffer. Although PM2.5 has multiple sources beyond vehicle emissions, including industrial emissions, residential heating, wildfires, and secondary air pollutants (e.g., SO₂ and NH₃) (McDuffie et al., 2021), the primary goal was to maintain consistency and comparability of land-use covariates across the two pollutants. To account for another major source of particulates in the area, distance from the airport was included as an additional covariate, given its role as a notable local emitter of particulate matter through aviation-related activities and associated ground traffic. This allowed for incorporating traffic-generated pollutants alongside other relevant PM2.5 sources while ensuring methodological consistency across pollutants. All distance measures of the land-use covariates were log-transformed, as were the outcome variables of NO2 and PM2.5.

Prediction models relied on universal kriging techniques to account for spatial structure while incorporating land use covariates. Variograms were created to assess spatial autocorrelation and were fit using either exponential, spherical, or Matern models to characterize the range, sill, and nuggets of the fitted variograms. Spherical models were selected by the statistical software as the best fitted variograms. Final prediction models were created using the annual mean concentrations at each stop location. An annual average of the 29 pollutant measurements per stop location were used in place of individual stop measurements due to computational limitations in modeling (additional methods justification can be found in Appendix 1). Five-fold and ten-fold cross-validation (CV) were used to assess model accuracy and predictive performance for log-transformed NO2 and PM2.5 concentrations. MSE-based R\^2 and RMSE were presented to evaluate these prediction models. Pollutant-specific predictions representing annual average concentrations were mapped at the census block centroid level for the study area. These census block predictions were averaged by census tract, and we calculated summary statistics for these predicted annual means by census tract.

### Association Between Demographic Variables and Predicted Pollutants

As our demographic variables were on the census tract level, we took the average block-level predictions by census tract to assess associations between demographic variables and predicted pollutants. Linear regression models were developed to investigate relationships between PM2.5 and NO2 concentrations and socio-demographic variables, including income, language, race/ethnicity, and geographic land-use characteristics. Predictor variables included the percentage of individuals below the FPL, the proportion of non-English speakers, and racial/ethnic composition at the census tract level. Racial/ethnic composition was approximated by the percentage of each racial or ethnic group, and thus, each group percentage was a different covariate. Our main model to test the association between sociodemographic factors and air pollution was a multivariate model with all socio-demographic covariates included. The regression equations for this were: $$log(Predicted PM2.5) = \beta_0 + \beta_1 PercentBelow Poverty + \beta_2PercentEnglish Language Only + \beta_3PercentSpanish Language +\\ \beta_4PercentOther Language + \beta_5PercentWhite + \beta_6PercentBlack + \beta_7PercentAsian + \beta_8PercentAmericanIndianAlaskaNative +\\ \beta_9PercentHawaiianOrPacificIslander + \beta_{10}PercentHispanicOrLatino $$ and $$log(Predicted NO2) = \beta_0 + \beta_1 PercentBelow Poverty + \beta_2PercentEnglish Language Only + \beta_3PercentSpanish Language +\\ \beta_4PercentOther Language + \beta_5PercentWhite + \beta_6PercentBlack + \beta_7PercentAsian + \beta_8PercentAmericanIndianAlaskaNative +\\ \beta_9PercentHawaiianOrPacificIslander + \beta_{10}PercentHispanicOrLatino $$

As a sensitivity analysis, univariate relationships between each demographic covariates and each pollutant were also modeled with simple linear regression, using the equation: $$log(pollutant) =\beta_0 + \beta_1SociodemographicVar $$

Estimates, standard errors, and 95% confidence intervals were summarized in tables and included in the Appendix. As the outcome variables were log-transformed, we exponentiated the results of all association models. Thus, each estimate represents the percent change in the pollutant associated with a one percent increase in the corresponding demographic variable.

Bivariate choropleth maps were created to visualize the spatial relationship between predicted air pollutant concentrations and the continuous sociodemographic variables (i.e., percent below the poverty limit and percent English-only speakers) at the census tract level. The quantile-based classification was used to divide both predicted pollutant concentrations and demographic variables into equal-sized groups, allowing for a 3x3 grid that highlights the variables’ joint distribution and relationship across the study area. Only the significant predictors from the regression for association analyses were mapped to identify census tracts within the study area with both greater pollutant concentrations and greater proportion of the socio-demographic variable.

# Results

## Summary Statistics

Histograms for NO2 and PM2.5 showed log-normal distributions (**Figure 1**), so all summary statistics and analyses, besides maps, are on the log scale. Maps are shown in the native scale to facilitate comparison with air quality standards.

```{r var.distributions}

#---- Means ----
no2_native <- ggplot(data = no2_stop_clean, aes(mean_value)) +
    geom_histogram(colour = "black", 
                   fill = "white") 

# NO2 plot on the log scale
no2_log <- ggplot(data = no2_stop_clean, aes(log_mean)) +
    geom_histogram(colour = "black", 
                   fill = "white") 

# PM2.5 plot on the native scale
pm25_native <- ggplot(data = pm25_stop_clean, aes(mean_value)) +
    geom_histogram(colour = "black", 
                   fill = "white") 

# PM2.5 plot on the log scale
pm25_log <- ggplot(data = pm25_stop_clean, aes(log_mean)) +
    geom_histogram(colour = "black", 
                   fill = "white") 

# Add plot type and scale information to the datasets
no2_native_data <- no2_stop_clean %>%
  mutate(scale = "Native Scale", pollutant = "NO2", value = mean_value)

no2_log_data <- no2_stop_clean %>%
  mutate(scale = "Log Scale", pollutant = "NO2", value = log_mean)

pm25_native_data <- pm25_stop_clean %>%
  mutate(scale = "Native Scale", pollutant = "PM2.5", value = mean_value)

pm25_log_data <- pm25_stop_clean %>%
  mutate(scale = "Log Scale", pollutant = "PM2.5", value = log_mean)

# Combine all datasets
combined_data <- bind_rows(no2_native_data, no2_log_data, pm25_native_data, pm25_log_data)

# Adjusting the scale levels to reorder the columns
combined_data <- combined_data %>%
  mutate(scale = factor(scale, levels = c("Native Scale", "Log Scale"))) 

# Create faceted plot
faceted_histogram <- ggplot(data = combined_data, aes(value)) +
  geom_histogram(colour = "black", fill = "white", bins = 30) +
  facet_grid(pollutant ~ scale, scales = "free_x") +
  labs(x = "Mean Values", y = "Frequency", title="Figure 1: Distribution of Mean Values",
       caption="Distribution of native and log-transformed mean values of NO2 (above)\n and PM2.5 (below) (n=8440 NO2 measurements, n=8638 PM2.5 measurements).\n Both variables are log-normally distributed.") + 
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5),
        plot.caption = element_text(hjust = 0.5)) +
  theme(panel.grid.minor = element_blank()) 

# Display the plot
print(faceted_histogram)
```

Across the 304 stop locations, data was collected across 193 census tracts within the study area. For the study period of March 2019-March 2020, the mean NO2 concentration was 9.15 ppb (SD = 2.47) ppb and the mean PM2.5 concentration was 4.62 ug/m\^3 (SD = 0.57 ug/m\^3) (**Table 1**).

```{r desc.stats.annual.data}
annual_clean %>% 
  mutate(variable = case_when(
    variable == "pm2.5_ug_m3" ~ "PM2.5 (ug/m3)",
    variable == "no2" ~ "NO2 (ppb)",
    TRUE ~ variable
  )) %>%
  group_by(variable) %>% 
  summarise(
  #  N = n(),
    "Arithmetic Mean" = mean(value),
    "SD" = sd(value),
    "Geometric Mean" = exp(mean(log(value), na.rm = TRUE)),
    "Geometric SD" = exp(sd(log(value), na.rm = TRUE)),
    Max = max(value),
    Min = min(value),
    Median = median(value)
  ) %>%
  rename(Pollutant = variable) %>% 
  kable(caption = "Table 1: Descriptive statistics for annual NO2 and PM2.5 mean concentrations across study area monitoring locations (N = 304)", digits = 2) %>% 
  kable_styling(full_width = FALSE, latex_options = c("hold_position")) %>% 
  add_footnote("Note: The mean of winsorized medians was used to summarize site annual averages.", # pulled wording from data dictionary 
               notation = "none", 
               threeparttable = TRUE)

```

```{r set.up.sf.data, include=FALSE, warning=FALSE}

latlong_proj <- 4326  

lambert_proj <- "+proj=lcc +lat_1=33 +lat_2=45 +lat_0=39 +lon_0=-96 +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs"

#transform stop data to Lambert for distances 
stop_for_preds <- st_as_sf(stop_for_preds, coords = c('longitude', 'latitude'), crs = 4326) %>%
  # # convert to a meters CRS
  st_transform(lambert_proj)

annual_for_preds <- st_as_sf(annual_for_preds, coords = c('longitude', 'latitude'), crs = 4326) %>%
  # # convert to a meters CRS
  st_transform(lambert_proj)

# Convert grid to sf
grid_covar_clean <- grid_covar_clean %>% 
  st_as_sf(coords = c('longitude', 'latitude'), crs = latlong_proj)

# Download the land polygon data as an sf multipolygon
# the CRS for this is in lat/long degrees
land <- ne_download(scale = "large", type = "land", category = "physical", returnclass = "sf")

# Crop the land area to the bounding box of the study grid to reduce processing time
# have to convert the grid to the same degrees as land
land <- suppressWarnings(st_crop(land, st_bbox(grid_covar_clean))) 

# Visualize cropped land area
ggplot(land) + geom_sf()

# Filter grid to keep only points that intersect with land
grid_covar_clean <- grid_covar_clean[st_within(grid_covar_clean, land) %>% lengths() > 0,]

# Visualize grid land locations (zoom in)
ggplot(grid_covar_clean) + geom_sf(size=0.001)

```

**Figure 2** shows the geographic distribution of stop sites and their mean annual concentrations on the native scale. A map of individual observations per stop site can be found in the Appendix. Of the stops, those near downtown Seattle and between Renton and Kent had the highest NO2 concentrations, at approximately 45 ppb. For PM2.5, concentrations were highest in downtown Seattle and North Seattle, where the annual averages were 5 to 6 ug/m\^3. Annual average concentrations of NO2 varied from approximately 5 to 20 ppb, and annual average concentrations of PM2.5 varied from approximately 4 to 6 ug/m\^3.

```{r study.area.map.setup, warning=FALSE}
# ---- Study Area Map Setup ----
# Define a bounding box (min & max X and Y) with a 10,000m buffer around `grid_covar_clean`
map_bbox <- grid_covar_clean %>%
  # convert from degrees to meters
  st_transform(crs = lambert_proj) %>%
  # add a buffer around the area for visualization purposes
  st_buffer(dist = 10000) %>%
  # convert back to original CRS
  st_transform(crs = latlong_proj) %>%
  # take the min/max X/Y
  st_bbox()


# Base map setup with ggplot2 and ggspatial using OSM tiles
g <- ggplot() +
  ggspatial::annotation_map_tile(type = "osm", zoom = 10, ) +
  theme_minimal()

# Plot background map and the Seattle grid (zoom in)
#g + geom_sf(data = grid_covar_clean, size=0.001)

#---- Annual data map
# Add NO2 data with additional map elements
no2_map_annual <- g + 
  geom_sf(data = annual_for_preds %>% filter(variable == "no2"), aes(color = value)) + 
  scale_color_viridis_c() + 
  theme_void() +  
  theme(
    panel.border = element_rect(color = "black", fill = NA, size = 1),
     plot.title = element_text(hjust = 0.5)
  ) + 
  ggspatial::annotation_scale(location = "bl", width_hint = 0.3, unit_category = "imperial") +
  ggspatial::annotation_north_arrow(location = "tr", which_north = "true", style = north_arrow_fancy_orienteering) +  
  labs(col="NO2 (ppb)", title="NO2"
       )

# Add PM2.5 data with additional map elements, restricting scale to 40 and below
pm25_map_annual <- g + 
  geom_sf(data = annual_for_preds %>% filter(variable == "pm2.5_ug_m3"), aes(color = value)) + 
  scale_color_viridis_c() +
  theme_void() +  
  theme(
    panel.border = element_rect(color = "black", fill = NA, size = 1),
    plot.title = element_text(hjust = 0.5)
  ) + 
  ggspatial::annotation_scale(location = "bl", width_hint = 0.3, unit_category = "imperial") +
  ggspatial::annotation_north_arrow(location = "tr", which_north = "true", style = north_arrow_fancy_orienteering) +  
  labs(col="PM2.5 (ug/m3)", title="PM2.5"
       )

no2_map_annual + pm25_map_annual + plot_annotation(title = 'Figure 2: Map of Study Area Annual \nAverage Concentrations',
  #subtitle = 'NO2 (left) and PM2.5 (right)',
  caption = 'This map captures the annual average concentrations of NO2 and PM2.5\n  at 304 monitoring locations. Both pollutants are presented on the native scale. \n NO2 is in ppb and PM2.5 is in ug/m3.',
  theme = theme(plot.title = element_text(face = "bold", hjust = 0.5),
                plot.subtitle=element_text(hjust=0.5),
                plot.caption=element_text(hjust=0.5)))

```

**Table 2** presents demographics for the study area. These tracts include 1,092,264 people in the study area. The racial and ethnic makeup of the total study area shows that the population is predominantly white (67.68%, N = 739,244). The next largest racial/ethnic group was Asian at 15.5 %, then Hispanic or Latino (9.25%), Black or African American (6.21%), Hawaiian or Pacific Islander 0.61 %, and American Indian or Alaska Native (0.50%). Categories of “Other”, “Two or More Races,” or “Three or More Races” were not included for simplicity purposes while acknowledging the exclusionary nature of this analytical decision. On average, 8.66 % of each census tract had an income below the federal poverty level (SD=5.8%). For languages spoken, 71.32% spoke English only, and 24.11% spoke a language other than English. 6.09% spoke Spanish and 2.58% spoke another language.

```{r demographics.table}

# Demographics table for study area
demo_summary <- acs_simplified %>% 
  filter(tract_key %in% unique(stop_w_acs$tract_key)) %>% 
  summarise(
    `Total Pop. (N)` = sum(Total_Pop),
    `Census Tracts`=length(unique(tract_key)),
    White = mean(White / Total_Pop) * 100,
    `Black or African-American` = mean(Black_AfricanAmerican / Total_Pop) * 100,
    `American Indian or Alaska Native` = mean(AIAN / Total_Pop) * 100,
    Asian = mean(Asian / Total_Pop) * 100,
    `Hawaiian or Pacific Islander` = mean(Hawaiian_PacificIslander / Total_Pop) * 100,
    `Hispanic or Latino` = mean(HispanicorLatino / Total_Pop) * 100,
    `Percent Below Poverty` = mean(Percent_Below_Poverty),
    `SD Percent Below Poverty` = sd(Percent_Below_Poverty),
    `English only` = mean(English_only / Total_Pop) * 100,
    `Language other than English` = mean(Language_other_than_English / Total_Pop) * 100,
    Spanish = mean(Spanish / Total_Pop) * 100,
    `Other language` = mean(Other / Total_Pop) * 100
  )

# Generate table
demo_summary %>% 
  kable(
    caption = "Table 2: Demographics of All Census Tracts in Study Area. All demographics are presented as percents besides total population and number of census tracts.",
    digits = 2
  ) %>%
  kable_styling()

```

## Prediction model results

```{r}
# Convert to a meter CRS for distance calculations
stop_for_preds <- st_transform(stop_for_preds, crs = lambert_proj) 

annual_for_preds <- st_transform(annual_for_preds, crs = lambert_proj) 
```

```{r no2.variograms, message=FALSE, include=FALSE}
# ---- Empirical Variogram Plots ----

# Variogram Cloud with stop_for_preds --> 24956646 observations
#vgm_no2_stop <- variogram(log_mean ~ pop10_s05000 + lu_industrial_p03000 + log_m_to_a1 + log_m_to_a2 + log_m_to_a3 + log_m_to_coast + log_m_to_l_airp + log_m_to_comm, stop_for_preds %>% filter(variable == "no2"), cloud = TRUE)

# Variogram Cloud with annual_for_preds --> 32135
vgm_no2_annual <- variogram(log_value ~ pop10_s05000 + lu_industrial_p03000 + log_m_to_a1 + log_m_to_a2 + log_m_to_a3 + log_m_to_coast + log_m_to_l_airp + log_m_to_comm, stop_for_preds, annual_for_preds %>% filter(variable == "no2"), cloud = TRUE)

# deleted code for the stop data because it runs forever

# moved the actual plot to the Appendix!
# ggplot(vgm_no2_annual, aes(x = dist, y=gamma)) + 
#   geom_point(alpha=0.1) + 
#   labs(x="Distance (meters)",
#        title="Variogram Cloud Using Annual Mean Concentration: NO2")


# Binned Variogram with annual data -- moved actual plot to appendix -cm
#plot(variogram(log_value ~ pop10_s05000 + lu_industrial_p03000 + log_m_to_a1 + log_m_to_a2 + log_m_to_a3 + log_m_to_coast + log_m_to_l_airp + log_m_to_comm, annual_for_preds %>% filter(variable == "no2")), main="Binned Variogram with Annual Concentration Data: NO2")

# Binned Variogram with Point Counts
#plot(variogram(log_value ~ pop10_s05000 + lu_industrial_p03000 + log_m_to_a1 + log_m_to_a2 + log_m_to_a3 + log_m_to_coast + log_m_to_l_airp + log_m_to_comm, annual_for_preds %>% filter(variable == "no2")), pl = TRUE, main="Binned Variogram with Annual Concentration Data with Point Counts: NO2")

# moved smoothed cloud variogram to Appendix
# Smoothed Cloud Variogram using ggplot2

```

```{r est.no2.var, message=FALSE, include=FALSE}
# Estimate the empirical variogram
##  By default, the variogram() function limits the maximum lag distance. Increasing the cutoff parameter will allow it to calculate semivariance values over a larger distance, which might help the semivariogram level off if it's naturally reaching a sill

v_annual <- variogram(log_value ~ pop10_s05000 + lu_industrial_p03000 + log_m_to_a1 + log_m_to_a2 + log_m_to_a3 + log_m_to_coast + log_m_to_l_airp + log_m_to_comm, data=annual_for_preds %>% filter(variable == "no2"))

# Fit a model to the variogram, trying exponential, spherical, and Matern options
v_annual.fit <- fit.variogram(v_annual, vgm(c("Exp", "Sph", "Mat")))

# Display the selected variogram model and its parameters (sill, range, nugget)
# Note: what model is selected? Spherical for both
#v_annual.fit

# Plot the empirical variogram with the fitted model overlaid
# consider expanding the x-axis here - moved to Appendix
# plot(v_annual, v_annual.fit, main="Empirical Variogram with Fitted Model Overlaid: NO2")

```

```{r fitting variogram for universal kriging no2, message=FALSE, include=FALSE}
# Estimate the variogram with a covariate predictor
# 100000 is way too high a cutoff

v_annual.uk <- variogram(log_value ~ log_m_to_a1 + log_m_to_a2 + log_m_to_a3 + log_m_to_coast + log_m_to_l_airp + log_m_to_comm + pop10_s05000 + lu_industrial_p03000, data=annual_for_preds %>% filter(variable=="no2"))

# Fit the variogram model with multiple options (Exponential, Spherical, Matern)
# note that this may have convergence issues. If so, you can try selecting one variogram model instead. You can also give it initial values for range, nugget etc. based on looking at the variogram cloud.

# sometimes has convergence issues 
m_annual.uk <- fit.variogram(v_annual.uk, vgm(c("Exp", "Sph", "Mat")))

# Alternatively, you could fit the variogram with modified initial values. This still has convergence issues.
# m.uk <- fit.variogram(v.uk, vgm("Exp", nugget = 0.01, psill = 0.03, range = 15000))


# Display the selected variogram model parameters
#m_annual.uk

```

```{r universal.kriging.prediction.no2.grid.annual, warning=FALSE, message=FALSE, include=FALSE}
#transform stop data to Lambert for distances 
grid_for_preds <- st_as_sf(grid_covar_clean, coords = c('longitude', 'latitude'), crs = 4326) %>%
  # # convert to a meters CRS
  st_transform(lambert_proj)

# ---- Universal Kriging Prediction Code from Lab 6 ----

# Fit the universal kriging model for NO2 annual data and predict on the grid 
ln.no2.kr <- krige(log_value ~ log_m_to_a1 + log_m_to_a2 + log_m_to_a3 + log_m_to_coast + log_m_to_l_airp + log_m_to_comm + pop10_s05000 + lu_industrial_p03000, 
                 annual_for_preds %>% filter(variable=="no2"), # CRS in meters
                 newdata = grid_for_preds, # CRS in meters
                 model = m_annual.uk)

# Calculate standard errors to assess prediction uncertainty across locations
ln.no2.kr$se <- sqrt(ln.no2.kr$var1.var)  # Standard error is the square root of variance

#plotting these in Appendix
```

```{r universal.kriging.prediction.no2.BLOCK, warning=FALSE, message=FALSE, include=FALSE}
#transform stop data to Lambert for distances 
blocks_for_preds <- st_as_sf(census_blocks_covar_clean, coords = c('longitude', 'latitude'), crs = 4326) %>%
  # # convert to a meters CRS
  st_transform(lambert_proj)

# ---- Universal Kriging Prediction Code from Lab 6 ----

# Fit the universal kriging model for PM2.5 and predict on the grid
ln.NO2.block.kr <- krige(log_value ~ log_m_to_a1 + log_m_to_a2 + log_m_to_a3 + log_m_to_coast + log_m_to_l_airp + log_m_to_comm + pop10_s05000 + lu_industrial_p03000, 
                 annual_for_preds %>% filter(variable=="no2"), # CRS in meters
                 newdata = blocks_for_preds, # CRS in meters
                 model = m_annual.uk)

# Calculate standard errors to assess prediction uncertainty across locations
ln.NO2.block.kr$se <- sqrt(ln.NO2.block.kr$var1.var)  # Standard error is the square root of variance

```

```{r generate.pm25.variogram, message=FALSE, include=FALSE}
#Generate variograms for pm25

# Estimate the variogram with a covariate predictor
v.uk.pm25 <- variogram(log_value ~ log_m_to_a1 + log_m_to_a2 + log_m_to_a3 + log_m_to_coast + log_m_to_l_airp + log_m_to_comm + pop10_s05000 + lu_industrial_p03000, data=annual_for_preds %>% filter(variable=="pm2.5_ug_m3"))
                  #,cutoff=5000)

# Fit the variogram model with multiple options (Exponential, Spherical, Matern)
# note that this may have convergence issues. If so, you can try selecting one variogram model instead. You can also give it initial values for range, nugget etc. based on looking at the variogram cloud.

m.uk.pm25 <- fit.variogram(v.uk.pm25, vgm(c("Exp", "Sph", "Mat")))

# Display the selected variogram model parameters
#m.uk.pm25

# Plot the empirical variogram with the fitted model
#plot(v.uk.pm25, model = m.uk.pm25)
```

```{r universal.kriging.prediction.pm25.grid, warning=FALSE, message=FALSE, include=FALSE}
# ---- Universal Kriging Prediction Code from Lab 6 ----

# Fit the universal kriging model for PM2.5 and predict on the grid
ln.PM25.kr.grid <- krige(log_value ~ log_m_to_a1 + log_m_to_a2 + log_m_to_a3 + log_m_to_coast + log_m_to_l_airp + log_m_to_comm + pop10_s05000 + lu_industrial_p03000, 
                 annual_for_preds %>% filter(variable=="pm2.5_ug_m3"), # CRS in meters
                 newdata = grid_for_preds, # CRS in meters
                 model = m.uk.pm25)

# Calculate standard errors to assess prediction uncertainty across locations
ln.PM25.kr.grid$se <- sqrt(ln.PM25.kr.grid$var1.var)  # Standard error is the square root of variance

```

```{r universal.kriging.prediction.pm25.BLOCK, warning=FALSE, message=FALSE, include=FALSE}
# ---- Universal Kriging Prediction Code from Lab 6 ----

# Fit the universal kriging model for PM2.5 and predict on the grid
ln.PM25.kr <- krige(log_value ~ log_m_to_a1 + log_m_to_a2 + log_m_to_a3 + log_m_to_coast + log_m_to_l_airp + log_m_to_comm + pop10_s05000 + lu_industrial_p03000, 
                 annual_for_preds %>% filter(variable=="pm2.5_ug_m3"), # CRS in meters
                 newdata = blocks_for_preds, # CRS in meters
                 model = m.uk.pm25)

# Calculate standard errors to assess prediction uncertainty across locations
ln.PM25.kr$se <- sqrt(ln.PM25.kr$var1.var)  # Standard error is the square root of variance

# moved plots to Appendix
# Plot UK predictions
#pl3 <- plot(ln.PM25.kr["var1.pred"], main = "UK Prediction of Log(PM2.5)")

# Plot UK prediction standard errors
#pl4 <- plot(ln.PM25.kr["se"], main = "UK Prediction Error PM2.5 (Standard Error)")

```

```{r define CV functions}
# ---- Define Cross-Validation Functions ----

# Wrapper function krige.cv2() to retain the projection of the sf object.
# This fixes a known bug in krige.cv() where projection information is lost.
# (Bug reported and fixed on GitHub, but this wrapper may be required for now.)
krige.cv2 <- function(formula, locations, model = NULL, ..., beta = NULL, 
                      nmax = Inf, nmin = 0, maxdist = Inf, 
                      nfold = nrow(locations),  # default is leave-one-out
                      verbose = interactive(), 
                      debug.level = 0) {
  
  # Perform cross-validation and retain projection if it's missing
  krige.cv1 <- krige.cv(formula = formula, locations = locations, model = model, ..., 
                        beta = beta, nmax = nmax, nmin = nmin, maxdist = maxdist, 
                        nfold = nfold, verbose = verbose, debug.level = debug.level)
  
  # Set projection from input data if krige.cv output lacks it
  if (is.na(st_crs(krige.cv1))) {
    st_crs(krige.cv1) <- st_crs(locations)
  }
  return(krige.cv1)
}

# Function to create a bubble plot for kriging residuals
krige.cv.bubble <- function(cv.out, plot_title) {
  ggplot(data = cv.out) +
    geom_sf(aes(size = abs(residual), color = factor(residual > 0)), alpha = 0.5) +
    scale_color_discrete(name = 'Residual > 0', direction = -1) +
    scale_size_continuous(name = '|Residual|') +
    ggtitle(plot_title) +
    theme_bw()
}

# Function to calculate performance metrics: RMSE and R²
krige.cv.stats <- function(krige.cv.output, description) {
  d <- krige.cv.output
  
  # Calculate Mean Squared Error (MSE) and R²
  mean_observed <- mean(d$observed)
  MSE_pred <- mean((d$observed - d$var1.pred)^2)
  MSE_obs <- mean((d$observed - mean_observed)^2)
  
  # Create a summary table with rounded RMSE and MSE-based R²
  tibble(
    Description = description, 
    RMSE = round(sqrt(MSE_pred), 4), 
    MSE_based_R2 = round(max(1 - MSE_pred / MSE_obs, 0), 4)
  )
}

```

```{r cross-validation-no2, warning=FALSE, message=FALSE}
# ---- Cross-Validation for log(no2)----

# Perform Universal Kriging (UK) with 5-fold Cross-Validation
cv5uk_no2 <- krige.cv2(log_value ~ log_m_to_a1 + log_m_to_a2 + log_m_to_a3 + log_m_to_coast + log_m_to_l_airp + log_m_to_comm + pop10_s05000 + lu_industrial_p03000, 
                 annual_for_preds %>% filter(variable=="no2"), 
                 model = m_annual.uk,
                 nfold = 5)

# Perform Universal Kriging (UK) with 10-fold Cross-Validation
cv10uk_no2 <- krige.cv2(log_value ~ log_m_to_a1 + log_m_to_a2 + log_m_to_a3 + log_m_to_coast + log_m_to_l_airp + log_m_to_comm + pop10_s05000 + lu_industrial_p03000, 
                 annual_for_preds %>% filter(variable=="no2"), 
                 model = m_annual.uk,
                 nfold = 10)

# # Calculate and compare performance statistics across cross-validation methods
# # Compile results into a summary table
# bind_rows(
#   krige.cv.stats(cv5uk_no2, "UK: 5-Fold CV NO2"),
#   krige.cv.stats(cv10uk_no2, "UK: 10-Fold CV NO2")
# ) %>% 
#   kable(caption = "Summary of Kriging Cross-Validation Results for log(NO2)") %>% kable_styling()

```

```{r cross-validation-pm25, warning=FALSE, message=FALSE}
# ---- Cross-Validation for log(PM2.5)----

# Perform Universal Kriging (UK) with 5-fold Cross-Validation
cv5uk_pm25 <- krige.cv2(log_value ~ log_m_to_a1 + log_m_to_a2 + log_m_to_a3 + log_m_to_coast + log_m_to_l_airp + log_m_to_comm + pop10_s05000 + lu_industrial_p03000, 
                 annual_for_preds %>% filter(variable=="pm2.5_ug_m3"), 
                 model = m.uk.pm25,
                 nfold = 5)

# Perform Universal Kriging (UK) with 10-fold Cross-Validation (LOOCV)
cv10uk_pm25 <- krige.cv2(log_value ~ log_m_to_a1 + log_m_to_a2 + log_m_to_a3 + log_m_to_coast + log_m_to_l_airp + log_m_to_comm + pop10_s05000 + lu_industrial_p03000, 
                 annual_for_preds %>% filter(variable=="pm2.5_ug_m3"), 
                 model = m.uk.pm25,
                 nfold = 10)

# # Calculate and compare performance statistics across cross-validation methods
# # Compile results into a summary table
# bind_rows(
#   krige.cv.stats(cv5uk_pm25, "UK: 5-Fold CV PM2.5"),
#   krige.cv.stats(cv10uk_pm25, "UK: 10-Fold CV PM2.5")
# ) %>% 
#   kable(caption = "Summary of Kriging Cross-Validation Results for log(PM2.5)") %>% kable_styling()

```

The variograms used for the universal kriging (UK) models are provided in the Appendix, while the cross-validation results are summarized in **Table 3**. Performance metrics, including Root Mean Squared Error (RMSE) and $R^2$ based on Mean Squared Error (MSE), were calculated for both NO2 and PM2.5. For NO2, the 5-fold cross-validation yielded an RMSE of 0.1293 (log(ppb)) and an $R^2$ of 0.7414, while the 10-fold cross-validation achieved an RMSE of 0.1289 (log(ppb)) and an $R^2$ of 0.7430, indicating robust model performance with marginal improvements using 10-fold CV. Similarly, for PM2.5, the 5-fold cross-validation produced an RMSE of 0.0727 (log(ug/m3)) and an $R^2$ of 0.6542, while the 10-fold cross-validation resulted in an RMSE of 0.0680 (log(ug/m3)) and an $R^2$ of 0.6975. These results demonstrate that the UK models performed consistently well for spatial interpolation of both pollutants, with slightly improved accuracy observed under the 10-fold cross-validation approach.

```{r CV.results.combined}

# Combine the summaries for NO2 and PM2.5
combined_CV_summary <- bind_rows(
  # Add the NO2 results
  bind_rows(
    krige.cv.stats(cv5uk_no2, "UK: 5-Fold CV"),
    krige.cv.stats(cv10uk_no2, "UK: 10-Fold CV")
  ) %>% mutate(Pollutant = "log(NO2)"),  

  # Add the PM2.5 results
  bind_rows(
    krige.cv.stats(cv5uk_pm25, "UK: 5-Fold CV"),
    krige.cv.stats(cv10uk_pm25, "UK: 10-Fold CV")
  ) %>% mutate(Pollutant = "log(PM2.5)")
)

# Rearrange columns 
combined_CV_summary <- combined_CV_summary %>%
  select(Description, Pollutant, everything())

# Display table
combined_CV_summary %>%
  kable(caption = "Table 3: Combined Summary of Universal Kriging Cross-Validation Results for log(NO2) and log(PM2.5)") %>%
  kable_styling()
```

```{r map.native.scale, message=FALSE}

# exponentiate log vars
ln.no2.kr$var1.pred.native <- exp(ln.no2.kr$var1.pred)
ln.PM25.kr$var1.pred.native <- exp(ln.PM25.kr$var1.pred)

# re-project back to long-lat proj
blocks_for_preds <- st_transform(blocks_for_preds, latlong_proj)
ln.no2.kr <- st_transform(ln.no2.kr, latlong_proj)
ln.PM25.kr <- st_transform(ln.PM25.kr, latlong_proj)

# check that coordinates are nearly identical
#all.equal(st_coordinates(blocks_for_preds), st_coordinates(ln.no2.kr))
#all.equal(st_coordinates(blocks_for_preds), st_coordinates(ln.PM25.kr))

# Join grid to predictions; do so by nearest feature to avoid precision merging issues
new_blocks_no2 <- st_join(blocks_for_preds, ln.no2.kr, join = st_nearest_feature) %>% 
  rename(`NO2 (ppb)` = var1.pred.native, 
         `ln(NO2) ln(ppb)`=var1.pred,
         `ln(NO2) var`=var1.var,
         `ln(NO2) se`=se)
new_blocks_pm25 <- st_join(blocks_for_preds, ln.PM25.kr, join = st_nearest_feature) %>% 
  rename(`PM2.5 (ug/m^3)` = var1.pred.native, 
         `ln(PM2.5) ln(ug/m^3)`=var1.pred,
         `ln(PM2.5) var`=var1.var,
         `ln(PM2.5) se`=se)

# Verify the join was successful (no NAs in predictions)
#all(!is.na(new_blocks_pm25$`ln(PM2.5) ln(ug/m^3)`)) 
#all(!is.na(new_blocks_no2$`ln(NO2) ln(ppb)`)) 
#yay!
```

Maps of the Seattle area with UK predictions overlaid as points can be found in **Figure 3**. The map of NO2 concentration predictions depicts greater concentrations along the underlying highway structure. Predicted NO2 was highest near downtown Seattle and along Interstate 5 (I-5). In the map of PM2.5 predictions, greater concentrations do not seem to correlate to major highways as much as in the NO2 predictions. Similarly to NO2, PM2.5 was highest near downtown Seattle, into North Seattle, and along I-5. Maps of the standard error from the UK models are shown in the Appendix.

```{r plot.points}
#NO2 - native scale
no2_uk_map <- ggplot() + ggspatial::annotation_map_tile(type = "osm", zoom = 10, ) + 
  theme_minimal() +
  geom_sf(data = new_blocks_no2, aes(color = `NO2 (ppb)`), alpha = 0.05) +
  # color friendly color scale
  scale_color_viridis_c(option = "plasma") + 
  ggtitle("Predicted NO2") +
  ggspatial::annotation_scale(location = "bl", width_hint = 0.3, unit_category = "imperial") +  # Scale in miles
  ggspatial::annotation_north_arrow(location = "tr", which_north = "true", style = north_arrow_fancy_orienteering)


#PM2.5 - native scale
pm25_uk_map <- ggplot() + ggspatial::annotation_map_tile(type = "osm", zoom = 10, ) +
  theme_minimal() +
  geom_sf(data = new_blocks_pm25, aes(color = `PM2.5 (ug/m^3)`), alpha = 0.05) +
  # color friendly color scale
  scale_color_viridis_c(option = "plasma") + 
  ggtitle("Predicted PM2.5") + ggspatial::annotation_scale(location = "bl", width_hint = 0.3, unit_category = "imperial") +  # Scale in miles
  ggspatial::annotation_north_arrow(location = "tr", which_north = "true", style = north_arrow_fancy_orienteering)

# Combine maps
uk_map <- (no2_uk_map | pm25_uk_map) + 
  plot_annotation(
    title = "Figure 3: Map of Study Area with UK\n NO2 and PM2.5 Predictions Overlaid as Points",
    theme = theme(
      plot.title = element_text(size = 14, face = "bold", hjust = 0.5, margin = margin(b = 20))
    )
  )

print(uk_map)

```

```{r merge.newblocks.acs}
# had to average the predictions over each tract based on the predicted blocks
predicted_to_tracts_no2 <- new_blocks_no2 %>% group_by(tract_key) %>%
  summarise("ln(NO2) ln(ppb)"=mean(`ln(NO2) ln(ppb)`),
            "ln(NO2) var" = mean(`ln(NO2) var`), "ln(NO2) se" = mean(`ln(NO2) se`),
            "NO2 (ppb)" = mean(`NO2 (ppb)`))

predicted_to_tracts_pm25 <- new_blocks_pm25 %>% group_by(tract_key) %>%
  summarise("ln(PM2.5) ln(ug/m^3)"=mean(`ln(PM2.5) ln(ug/m^3)`),
            "ln(PM2.5) var" = mean(`ln(PM2.5) var`), "ln(PM2.5) se" = mean(`ln(PM2.5) se`),
            "PM2.5 (ug/m^3)" = mean(`PM2.5 (ug/m^3)`))

full_data_w_preds <- acs_simplified %>% left_join(predicted_to_tracts_no2, join_by(tract_key==tract_key)) %>% left_join(predicted_to_tracts_pm25, join_by(tract_key==tract_key)) %>% select(-c(geometry.x, geometry.y)) %>% 
  filter(!is.na(`ln(NO2) ln(ppb)`) | !is.na(`ln(PM2.5) ln(ug/m^3)`))
```

**Table 4** summarizes the descriptive statistics of the predicted annual means of NO2 and PM2.5 concentrations in the study area. Predicted NO2 concentrations had an arithmetic mean of 9.35 ppb and a geometric mean of 9.09 ppb, with a standard deviation of 2.35 ppb and a maximum value of 20.98 ppb. In contrast, PM2.5 concentrations were lower, with an arithmetic and geometric mean of 4.67 µg/m\^3 and 4.65 µg/m\^3, respectively, and a standard deviation of 0.51 µg/m\^3. PM2.5 concentrations ranged from 3.47 µg/m\^3 to 6.00 µg/m\^3. These predicted values are consistent with the observed data described in Table 1.

```{r desc.stats.pred.data}

full_data_w_preds %>% 
  pivot_longer(cols=contains(c("NO2", "PM2.5")),
               names_to = "variable") %>%
  filter(variable == "NO2 (ppb)" | variable == "PM2.5 (ug/m^3)") %>%
  group_by(variable) %>% 
  summarise(
    #"Census tracts" = n(),
    "Arithmetic Mean" = mean(value),
    "SD" = sd(value),
    "Geometric Mean" = exp(mean(log(value), na.rm = TRUE)),
    "Geometric SD" = exp(sd(log(value), na.rm = TRUE)),
    Max = max(value),
    Min = min(value),
    Median = median(value)
  ) %>%
  kable(caption = "Table 4: Descriptive statistics for predicted NO2 and PM2.5 annual means in study area (n=190 census tracts).", digits = 2) %>% 
  kable_styling(full_width = FALSE, latex_options = c("hold_position")) %>% 
  add_footnote("Note: The mean of winsorized medians was used to summarize site annual averages.", # pulled wording from data dictionary 
               notation = "none", 
               threeparttable = TRUE)

```

## Associations Between Pollutant Concentrations & Demographics

```{r q3.univariate.reg.assoc.pm25}
# Regression between annual PM2.5 concentrations and various demographics

# Created new columns for percent of population for each race (same as those included in demographic statistics summary table (except for "Other Langugage"))

full_data_w_preds_perc <- full_data_w_preds %>% 
    mutate(
           p_White = (White / Total_Pop)*100,
           p_BlackAA = (Black_AfricanAmerican/ Total_Pop)*100,
           p_AIAN = (AIAN / Total_Pop)*100,
           p_Asian = (Asian / Total_Pop)*100,
           p_HPI = (Hawaiian_PacificIslander / Total_Pop)*100,
           p_Hispanic = (HispanicorLatino / Total_Pop)*100,
           p_engl_only = (English_only / Total_Pop)*100,
           p_lang_other = (Language_other_than_English / Total_Pop)*100,
           p_spanish = (Spanish / Total_Pop)*100
           )


#PM2.5 x poverty
pm_poverty <- lm(`ln(PM2.5) ln(ug/m^3)` ~ Percent_Below_Poverty, 
                 data = full_data_w_preds)
pm_poverty_res <- tidy(pm_poverty, conf.int=TRUE, exponentiate=TRUE) %>%
  mutate(intercept=case_when(term=="Percent_Below_Poverty" ~ 4.21,
                             .default=NA))
           
# PM2.5 x White
pm_white <- lm(`ln(PM2.5) ln(ug/m^3)` ~ p_White, data = full_data_w_preds_perc)
pm_white_res <- tidy(pm_white, conf.int=TRUE, exponentiate=TRUE) %>%
  mutate(intercept=case_when(term=="p_White" ~ 4.40,
                             .default=NA))

# PM2.5 x Black African American
pm_BlackAA <- lm(`ln(PM2.5) ln(ug/m^3)` ~ p_BlackAA, data = full_data_w_preds_perc)
pm_BlackAA_res <- tidy(pm_BlackAA, conf.int=TRUE, exponentiate=TRUE) %>%
  mutate(intercept=case_when(term=="p_BlackAA" ~ 4.31,
                             .default=NA))

# PM2.5 x AIAN
pm_AIAN <- lm(`ln(PM2.5) ln(ug/m^3)` ~ p_AIAN, data = full_data_w_preds_perc)
pm_AIAN_res <- tidy(pm_AIAN, conf.int=TRUE, exponentiate=TRUE) %>%
  mutate(intercept=case_when(term=="p_AIAN" ~ 4.40,
                             .default=NA))

# PM2.5 x Asian
pm_Asian <- lm(`ln(PM2.5) ln(ug/m^3)` ~ p_Asian, data = full_data_w_preds_perc)
pm_Asian_res <- tidy(pm_Asian, conf.int=TRUE, exponentiate=TRUE) %>%
  mutate(intercept=case_when(term=="p_Asian" ~ 4.39,
                             .default=NA))

# PM2.5 x HPI
pm_HPI <- lm(`ln(PM2.5) ln(ug/m^3)` ~ p_HPI, data = full_data_w_preds_perc)
pm_HPI_res <- tidy(pm_HPI, conf.int=TRUE, exponentiate=TRUE) %>%
  mutate(intercept=case_when(term=="p_HPI" ~ 4.38,
                             .default=NA))

# PM2.5 x Hispanic
pm_Hispanic <- lm(`ln(PM2.5) ln(ug/m^3)` ~ p_Hispanic, data = full_data_w_preds_perc)
pm_Hispanic_res <- tidy(pm_Hispanic, conf.int=TRUE, exponentiate=TRUE) %>%
  mutate(intercept=case_when(term=="p_Hispanic" ~ 4.36,
                             .default=NA))

# PM2.5 x language
pm_engl_only <- lm(`ln(PM2.5) ln(ug/m^3)` ~ p_engl_only, data = full_data_w_preds_perc)
pm_engl_only_res <- tidy(pm_engl_only, conf.int=TRUE, exponentiate=TRUE) %>%
  mutate(intercept=case_when(term=="p_engl_only" ~ 4.38,
                             .default=NA))

pm_lang_other <- lm(`ln(PM2.5) ln(ug/m^3)` ~ p_lang_other, data = full_data_w_preds_perc)
pm_lang_other_res <- tidy(pm_lang_other, conf.int=TRUE, exponentiate=TRUE) %>%
  mutate(intercept=case_when(term=="p_lang_other" ~ 4.38,
                             .default=NA))

pm_spanish <- lm(`ln(PM2.5) ln(ug/m^3)` ~ p_spanish, data = full_data_w_preds_perc)
pm_spanish_res <- tidy(pm_spanish, conf.int=TRUE, exponentiate=TRUE) %>%
  mutate(intercept=case_when(term=="p_spanish" ~ 4.36,
                             .default=NA))
  
pm_univar_res <- rbind(pm_poverty_res,pm_white_res,pm_BlackAA_res,pm_AIAN_res,
                       pm_Asian_res, pm_HPI_res, pm_Hispanic_res, pm_engl_only_res,
                       pm_lang_other_res,pm_spanish_res) %>% 
  filter(term!="(Intercept)") %>%
  relocate(intercept, .before=estimate)

```

A multiple linear regression analysis (MLR) for predicted PM2.5 concentrations (μg/m\^3) explored associations with various demographic and socioeconomic variables **Table 5**. The model fit was statistically significant and explained approximately 16.8% of the variance in predicted PM2.5 levels (Adjusted $R^2$ = 12.15%, Residual Standard Error = 0.1033), with an F-statistic of 3.613 (p-value = 0.0002). The intercept of 3.452 represents the baseline PM2.5 level when all predictors are at their reference values. A statistically significant positive association was observed with the percentage of individuals living below the poverty line (Estimate = 1.005, p = 0.001, 95% CI: 1.002–1.008), suggesting that a 1% increase in the poverty rate is associated with a 0.5% increase in PM2.5 levels. Other demographic and socioeconomic variables, including language composition and racial/ethnic groups, did not exhibit statistically significant associations with PM2.5 concentrations.

```{r q3.multivariate.reg.assoc.pm25}
# Multiple linear regression model for PM2.5
pm_full <- lm(`ln(PM2.5) ln(ug/m^3)` ~ Percent_Below_Poverty + p_engl_only + p_lang_other + p_spanish + p_White + p_BlackAA + p_AIAN + p_Asian + p_HPI + p_Hispanic, data = full_data_w_preds_perc)

# Extract regression results for PM2.5 model
pm_full_results <- tidy(pm_full, conf.int=TRUE, exponentiate=TRUE)

# Formatted table for regression results
pm_full_results %>%
  select(term, estimate, std.error, statistic, p.value, conf.low, conf.high) %>% 
  mutate(
    Term = case_when(
      term == "(Intercept)" ~ "Intercept",
      term == "Percent_Below_Poverty" ~ "% Below Poverty",
      term == "p_engl_only" ~ "% English Language Only",
      term == "p_lang_other" ~ "% Other Language",
      term == "p_spanish" ~ "% Spanish Language",
      term == "p_White" ~ "% White",
      term == "p_BlackAA" ~ "% Black or African American",
      term == "p_AIAN" ~ "% American Indian or Alaska Native",
      term == "p_Asian" ~ "% Asian",
      term == "p_HPI" ~ "% Hawaiian or Pacific Islander",
      term == "p_Hispanic" ~ "% Hispanic or Latino",
      TRUE ~ term 
    )
  ) %>%
  select(Term, estimate, std.error, statistic, p.value, conf.low, conf.high) %>%
  rename(
    Estimate = estimate,
    `Std. Error` = std.error,
    `t-value` = statistic,
    `P-value` = p.value,
    `95%CI Low` = conf.low,
    `95%CI High` = conf.high
  ) %>% 
  kable(
    caption = "Table 5: Regression for Association Results for PM2.5 Model. Response variable was log(PM2.5), and all results have been exponentiated. Multiple R-squared was 0.168, RSE was 0.103, F-statistic was 3.613, p=0.0002.",
    digits = 3, 
    col.names = c("Term", "Estimate", "Std. Error", "t-value", "P-value", "95% CI Low", "95% CI High")
  ) %>%
  kable_styling(
    full_width = FALSE, 
    bootstrap_options = c("striped", "hover", "condensed")
  )

```

```{r q3.univariate.reg.assoc.no2}
# Regression between annual PM2.5 concentrations and various demographics

# Created new columns for percent of population for each race (same as those included in demographic statistics summary table (except for "Other Language"))


#NO2 x poverty
no2_poverty <- lm(`ln(NO2) ln(ppb)` ~ Percent_Below_Poverty, 
                 data = full_data_w_preds)
no2_poverty_res <- tidy(no2_poverty, conf.int=TRUE, exponentiate=TRUE) %>%
  mutate(intercept=case_when(term=="Percent_Below_Poverty" ~ 6.86,
                             .default=NA))
           
# PM2.5 x White
no2_white <- lm(`ln(NO2) ln(ppb)` ~ p_White, data = full_data_w_preds_perc)
no2_white_res <- tidy(no2_white, conf.int=TRUE, exponentiate=TRUE) %>%
  mutate(intercept=case_when(term=="p_White" ~ 7.95,
                             .default=NA))

# PM2.5 x Black African American
no2_BlackAA <- lm(`ln(NO2) ln(ppb)` ~ p_BlackAA, data = full_data_w_preds_perc)
no2_BlackAA_res <- tidy(no2_BlackAA, conf.int=TRUE, exponentiate=TRUE) %>%
  mutate(intercept=case_when(term=="p_BlackAA" ~ 7.40,
                             .default=NA))

# PM2.5 x AIAN
no2_AIAN <- lm(`ln(NO2) ln(ppb)` ~ p_AIAN, data = full_data_w_preds_perc)
no2_AIAN_res <- tidy(no2_AIAN, conf.int=TRUE, exponentiate=TRUE) %>%
  mutate(intercept=case_when(term=="p_AIAN" ~ 7.81,
                             .default=NA))

# PM2.5 x Asian
no2_Asian <- lm(`ln(NO2) ln(ppb)` ~ p_Asian, data = full_data_w_preds_perc)
no2_Asian_res <- tidy(no2_Asian, conf.int=TRUE, exponentiate=TRUE) %>%
  mutate(intercept=case_when(term=="p_Asian" ~ 7.77,
                             .default=NA))

# PM2.5 x HPI
no2_HPI <- lm(`ln(NO2) ln(ppb)` ~ p_HPI, data = full_data_w_preds_perc)
no2_HPI_res <- tidy(no2_HPI, conf.int=TRUE, exponentiate=TRUE) %>%
  mutate(intercept=case_when(term=="p_HPI" ~ 7.74,
                             .default=NA))

# PM2.5 x Hispanic
no2_Hispanic <- lm(`ln(NO2) ln(ppb)` ~ p_Hispanic, data = full_data_w_preds_perc)
no2_Hispanic_res <- tidy(no2_Hispanic, conf.int=TRUE, exponentiate=TRUE) %>%
  mutate(intercept=case_when(term=="p_Hispanic" ~ 7.62,
                             .default=NA))

# PM2.5 x language
no2_engl_only <- lm(`ln(NO2) ln(ppb)` ~ p_engl_only, data = full_data_w_preds_perc)
no2_engl_only_res <- tidy(no2_engl_only, conf.int=TRUE, exponentiate=TRUE) %>%
  mutate(intercept=case_when(term=="p_engl_only" ~ 7.79,
                             .default=NA))

no2_lang_other <- lm(`ln(NO2) ln(ppb)` ~ p_lang_other, data = full_data_w_preds_perc)
no2_lang_other_res <- tidy(no2_lang_other, conf.int=TRUE, exponentiate=TRUE) %>%
  mutate(intercept=case_when(term=="p_lang_other" ~ 7.74,
                             .default=NA))

no2_spanish <- lm(`ln(NO2) ln(ppb)` ~ p_spanish, data = full_data_w_preds_perc)
no2_spanish_res <- tidy(no2_spanish, conf.int=TRUE, exponentiate=TRUE) %>%
  mutate(intercept=case_when(term=="p_spanish" ~ 7.63,
                             .default=NA))
  
no2_univar_res <- rbind(no2_poverty_res, no2_white_res, no2_BlackAA_res, no2_AIAN_res,
                       no2_Asian_res, no2_HPI_res, no2_Hispanic_res, no2_engl_only_res,
                       no2_lang_other_res, no2_spanish_res) %>% 
  filter(term!="(Intercept)") %>%
  relocate(intercept, .before=estimate)
```

A second MLR analysis for predicted NO2 concentrations (ppb) was conducted **Table 6**. The model fit was statistically significant and explained approximately 23.75% of the variance in predicted NO2 concentrations (Adjusted $R^2$ = 19.49%, Residual Standard Error = 0.2057), with an F-statistic of 5.574 (p-value \< 3.189e-7). The intercept of 4.208 represents the baseline NO2 level when all predictors are at their reference values. A statistically significant positive association was observed between NO2 concentrations and the percentage of individuals living below the poverty line (Estimate = 1.013, p \< 0.001, 95% CI: 1.007–1.019), indicating that a 1% increase in the poverty rate corresponds to a 1.3% increase in NO2 levels. Similarly, areas with higher proportions of English-only speakers were significantly associated with elevated NO2 concentrations (Estimate = 1.011, p = 0.023, 95% CI: 1.001–1.020). However, no significant associations were observed for other variables, including the percent of White individuals (Estimate = 0.997, p = 0.390, 95% CI: 0.989–1.005) or other demographic groups, such as Spanish speakers, Black or African American populations, and Hispanic or Latino populations.

```{r q3.multivariate.reg.assoc.no2}
# Multiple linear regression model for NO2
no2_full <- lm(`ln(NO2) ln(ppb)` ~ Percent_Below_Poverty + p_engl_only + p_lang_other + p_spanish + p_White + p_BlackAA + p_AIAN + p_Asian + p_HPI + p_Hispanic, data = full_data_w_preds_perc)

# Extract regression results for NO2 model
no2_full_results <- tidy(no2_full, conf.int=TRUE, exponentiate=TRUE)

# Formatted table for regression results
no2_full_results %>%
  select(term, estimate, std.error, statistic, p.value, conf.low, conf.high) %>% 
  mutate(
    Term = case_when(
      term == "(Intercept)" ~ "Intercept",
      term == "Percent_Below_Poverty" ~ "% Below Poverty",
      term == "p_engl_only" ~ "% English Language Only",
      term == "p_lang_other" ~ "% Other Language",
      term == "p_spanish" ~ "% Spanish Language",
      term == "p_White" ~ "% White",
      term == "p_BlackAA" ~ "% Black or African American",
      term == "p_AIAN" ~ "% American Indian or Alaska Native",
      term == "p_Asian" ~ "% Asian",
      term == "p_HPI" ~ "% Hawaiian or Pacific Islander",
      term == "p_Hispanic" ~ "% Hispanic or Latino",
      TRUE ~ term 
    )
  ) %>%
  select(Term, estimate, std.error, statistic, p.value, conf.low, conf.high) %>%
  rename(
    Estimate = estimate,
    `Std. Error` = std.error,
    `t-value` = statistic,
    `P-value` = p.value,
    `95%CI Low` = conf.low,
    `95%CI High` = conf.high
  ) %>% 
  kable(
    caption = "Table 6: Regression for Association Results for NO2 Model. Response variable was log(NO2), and all results have been exponentiated. Multiple R-squared was 0.238, RSE was 0.206, F-statistic was 5.574, p<0.0001.",
    digits = 3, 
    col.names = c("Term", "Estimate", "Std. Error", "t-value", "P-value", "95% CI Low", "95% CI High")
  ) %>%
  kable_styling(
    full_width = FALSE, 
    bootstrap_options = c("striped", "hover", "condensed")
  )
```

## Bivariate choropleth visualization of predicted pollutants with demographic variables

At the census tract, the relationship between predicted pollutant concentrations and the demographic predictors identified as significant from the regression for association analysis are shown in the bivariate choropleth maps of **Figures 4, 5, and 6**. **Figure 4** depicts the relationship between the percent of the population below poverty and predicted PM2.5 concentrations for each census tract. The most burdened census tracts are concentrated in Downtown Seattle and along major highways, such as I-5 and SeaTac International Airport. The southern and eastern regions of the study predominantly feature census tracts with a higher percentage of the population below poverty but comparatively lower PM2.5 concentrations. The central and western areas exhibit census tracts with elevated PM2.5 concentrations relative to their wealth.

```{r pm25.choropleth.map, warning=FALSE}

# Ensure `census_clean` is an sf object
census_clean <- st_as_sf(census_clean)

# Select only the `AFFGEOID` and `geometry` columns
census_geometry <- census_clean %>%
  select(AFFGEOID, geometry) %>% 
  rename(GEO_ID = AFFGEOID)

# Drop geometry temporarily
census_geometry_nonspatial <- st_drop_geometry(census_geometry)

# Perform join
full_data_w_preds_perc_spatial <- full_data_w_preds_perc %>%
  left_join(census_geometry_nonspatial, by = "GEO_ID") 

# Reattach geometry to the joined data
full_data_w_preds_perc_spatial <- st_as_sf(
  left_join(census_clean, full_data_w_preds_perc_spatial, by = c("AFFGEOID" = "GEO_ID"))
) %>% 
  filter(!is.na(NAME.y))


# generating plots for significant predictors from regression results

# PM2.5 and % Below Poverty Map

# Bivariate classification for PM2.5 and Poverty
pm_poverty_bivariate <- bi_class(
  full_data_w_preds_perc_spatial,
  x = `PM2.5 (ug/m^3)`, 
  y = Percent_Below_Poverty, 
  style = "quantile", 
  dim = 3
)

# Plot the bivariate map
pm_poverty_map <- ggplot() +
  ggspatial::annotation_map_tile(type = "osm", zoom = 10) +  
  geom_sf(data = pm_poverty_bivariate, aes(fill = bi_class), color = NA) +
  bi_scale_fill(pal = "PurpleGrn", dim = 3, name = NULL) +
  labs(
    title = "Figure 4: Relationship Between % Below Poverty \nand Predicted PM2.5 Concentrations"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 14, face = "bold", hjust = 0.5),
    legend.position = "none"
  )

# Create the bivariate legend
bivariate_legend <- bi_legend(
  pal = "PurpleGrn",
  dim = 3,
  xlab = "Higher PM2.5",
  ylab = "Greater % Below Poverty",
  size = 8  
)

# Combine the map and the legend using patchwork
pm_poverty_map <- pm_poverty_map + 
  wrap_elements(full = bivariate_legend) +
  plot_layout(
    widths = c(10, 2),  
    heights = c(1)
  )

# Display the final plot
print(pm_poverty_map)

```

**Figure 5** depicts the relationship between the percentage of the population below poverty and predicted NO2 concentrations. Similar to PM2.5, census tracts with the highest poverty percentages and NO2 concentrations are often concentrated near urban centers and major transportation corridors.

```{r no2.choropleth.map}
## generating plots for significant predictors from regression results

# NO2 and % Below Poverty Map
# Classify data for bivariate mapping
no2_poverty_bivariate <- bi_class(
  full_data_w_preds_perc_spatial,
  x = `NO2 (ppb)`, 
  y = Percent_Below_Poverty, 
  style = "quantile", 
  dim = 3 
)

# Define the bounding box for the study area
map_bbox <- st_bbox(no2_poverty_bivariate)

# Generate the bivariate map
no2_poverty_map <- ggplot() +
  ggspatial::annotation_map_tile(type = "osm", zoom = 10) +  
  geom_sf(data = no2_poverty_bivariate, aes(fill = bi_class), color = NA) +
  bi_scale_fill(pal = "PurpleGrn", dim = 3, name = NULL) +
  labs(
    title = "Figure 5: Relationship Between % Below Poverty \nand Predicted NO2 Concentrations"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    plot.subtitle = element_text(size = 12),
    plot.caption = element_text(size = 10),
    legend.position = "none"
  )

# Create the bivariate legend
bivariate_legend <- bi_legend(
  pal = "PurpleGrn",
  dim = 3,
  xlab = "Higher NO2",
  ylab = "Greater % Below Poverty",
  size = 8  
)

# Combine the map and the legend using patchwork
no2_poverty_map <- no2_poverty_map + 
  wrap_elements(full = bivariate_legend) +
  plot_layout(
    widths = c(10, 2),  
    heights = c(1)
  )

# Display the final plot
print(no2_poverty_map)

```

**Figure 6** visualizes the relationship between the percent of English-only speakers and predicted NO2 concentrations within each census tract. Tracts with the highest NO2 levels tend to coincide with areas where a larger proportion of the population only speaks English, though areas in South Seattle are characterized with greater NO2 and lower proportions of its population speaking only English.

```{r}
# NO2 and % English Language Only Map

# Classify data for bivariate mapping
no2_english_bivariate <- bi_class(
  full_data_w_preds_perc_spatial,
  x = `NO2 (ppb)`, 
  y = 'p_engl_only', 
  style = "quantile", 
  dim = 3 
)

# Generate the bivariate map
no2_english_map <- ggplot() +
  ggspatial::annotation_map_tile(type = "osm", zoom = 10) +  
  geom_sf(data = no2_english_bivariate, aes(fill = bi_class), color = NA) +
  bi_scale_fill(pal = "PurpleGrn", dim = 3, name = NULL) +
  labs(
    title = "Figure 6: Relationship Between % Only English \nSpeakers and Predicted NO2 Concentrations"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    plot.subtitle = element_text(size = 12),
    plot.caption = element_text(size = 10),
    legend.position = "none"
  )

# Create the bivariate legend
bivariate_legend <- bi_legend(
  pal = "PurpleGrn",
  dim = 3,
  xlab = "Higher NO2",
  ylab = "Greater % English only",
  size = 8  
)

# Combine the map and the legend using patchwork
no2_english_map <- no2_english_map + 
  wrap_elements(full = bivariate_legend) +
  plot_layout(
    widths = c(10, 2),  
    heights = c(1)
  )

# Display the final plot
print(no2_english_map)

```

```{r}
# Ensure Percent_Below_Poverty in grid_w_acs is numeric
grid_w_acs <- grid_w_acs %>%
  mutate(
    Percent_Below_Poverty = as.numeric(Percent_Below_Poverty),
    White = as.numeric(White),
    Language_other_than_English = as.numeric(Language_other_than_English),
    log_m_to_a1 = as.numeric(log_m_to_a1),
    log_m_to_comm = as.numeric(log_m_to_comm)
  )

# Check for any NA values in the predictors and handle them
grid_w_acs <- grid_w_acs %>%
  filter(
    !is.na(Percent_Below_Poverty) &
    !is.na(White) &
    !is.na(Language_other_than_English) &
    !is.na(log_m_to_a1) &
    !is.na(log_m_to_comm)
  )

## These do not account for spatial structure since they do not have UK, commenting them out (Cecilia)
# Predict PM2.5 concentrations
# grid_w_acs$predicted_pm25 <- predict(pm25_model, newdata = grid_w_acs)

# Display the first few rows of the predictions
# head(grid_w_acs$predicted_pm25)

# Predict PM2.5 concentrations
# rid_w_acs$predicted_no2 <- predict(no2_model, newdata = grid_w_acs)

# Display the first few rows of the predictions
# head(grid_w_acs$predicted_no2)

# Assuming `grid_w_acs` has a column `tract_key`

newgrid_w_acs <- grid_w_acs %>%    mutate(TRACTCE = substr(as.character(tract_key), 
            nchar(as.character(tract_key)) - 5, nchar(as.character(tract_key))))
newgrid_w_acs2 <- left_join(newgrid_w_acs, census_clean, by = "TRACTCE")

```

# Discussion

The pollutant concentrations observed throughout the study, on average, were below the one-year average National Ambient Air Quality Standard (NAAQS) for both NO2 and PM2.5 (NAAQS Table, 2024). While NO2 was characterized as much lower than its NAAQS, PM2.5 was much closer to its NAAQS, indicating that current efforts are sufficient–according to this analysis–in keeping the Seattle area within compliance with the standards set by the Clean Air Act. The study area was also characterized by fairly homogeneous concentrations of PM2.5, ranging from about 4 to 5 ug/m\^3, and more heterogeneous NO2 concentrations, ranging from about 5 to 25 ppb, which reduced the variability of our data. This is in contrast to other urban areas in the United States, such as Los Angeles or Chicago, that exhibit much higher TRAP levels and, at times, are not in NAAQS compliance (Allen et al., 2009).

The universal kriging models for NO2 and PM2.5 demonstrated strong predictive performance, with our 5-fold and 10-fold cross-validation metrics indicating robust spatial interpolation across models. The predicted map of NO2 illustrates that concentrations were highest near downtown Seattle and along I-5, reflecting the influence of traffic emissions. This finding is consistent with previous literature on the association between pollutant levels and traffic proximity, as well as on the high performance of the universal kriging model in predicting such relationships with relevant land use variables (Mercer et al., 2011). The predicted map of PM2.5 concentrations also exhibited peak values in the downtown area but were less aligned with road networks and were less spatially concentrated. This suggests that additional sources of PM2.5 are not as well captured by our selected land-use covariates in the prediction model, as compared to the NO2 model.

The findings from the MLR models for predicted annual PM2.5 (μg/m³) and NO2 (ppb) concentrations consistently highlight poverty as a significant predictor of exposure to both pollutants, corroborating prior research linking socioeconomic disadvantage to heightened environmental pollution burdens (Bramble et al., 2023; Chi et al., 2016). While some associations with racial and ethnic variables were non-significant, poverty consistently demonstrated a small but significant relationship with pollutant exposure. The relatively low adjusted R-squared of both models suggests that other factors, such as unmeasured sources of air pollutants’ spatial variability and environmental conditions, also play a role in shaping PM2.5 and NO2 exposure.These results emphasize the multifaceted nature of air pollution disparities, shaped by both demographic and spatial factors. Future studies should consider additional confounding variables, explore spatial heterogeneity in pollutant distribution, and refine models to improve explanatory power.

The spatial relationships between demographic variables and pollutant concentrations are further illustrated through bivariate choropleth maps. These visualizations provide spatial representations of the disparities identified in the regression analyses, emphasizing the heightened exposure faced by disadvantaged communities. Elevated NO2 levels, in particular, were associated with lower-income communities, highlighting critical public health and environmental justice implications. Additionally, a greater percentage of only English speaking populations was also identified as a significant predictor of higher NO2 levels. This highlights the complexity of linguistic diversity as a potential social determinant of health. For instance, among children who did not speak English at home, a study of vehicular air pollution found significantly higher exposures among Black children, as compared to white children (Rubio et al., 2021). This underscores the influence of multiple identities in environmental exposures and the importance of considering these factors collectively. The observed spatial and demographic patterns align with broader societal inequities, where marginalized communities often reside in areas with higher pollution levels due to systemic issues such as housing segregation, economic disinvestment, and siting of pollutant sources like roadways and factories. Overall, our findings support targeted interventions that prioritize addressing elevated pollution levels in disproportionately impacted communities to reduce exposure-related health risks and advance environmental equity.

Notably, our study builds upon the work of Bramble et al. (2023) by addressing disparities in TRAP exposure using mobile monitoring data, while diverging in our focus on different pollutants and sociodemographic metrics. Bramble et al. evaluated multiple pollutants with a specific emphasis on historical redlining grades and income disparities at the census-block level. Their study also used ACS data from a decade before the monitoring data were collected, potentially resulting in misclassification. In contrast, our study focused on NO2 and PM2.5 and incorporated updated 2019 ACS demographic data. While Bramble et al. incorporated more geographic covariates (N = 191) in their prediction model, both our models exhibit similar cross-validated R\^2 values. This suggests that our simplified universal kriging model may be sufficient in predicting the spatial distribution of these air pollutants, while also being more interpretable and actionable. Additionally, while Bramble et al. showed significant relationships between historical HOLC grades and pollutant exposures, we emphasized current socio-demographic variables like poverty and language diversity. Our selected variables do not fully account for the systemic factors driving social inequities and determinants of health, thus resulting in smaller effect estimates than those found in Bramble’s HOLC grade analysis. The methodological differences and pollutant focus in our study highlight complementary perspectives on environmental justice in the Seattle metropolitan area to those found by Bramble et al.

## Strengths and Limitations

This study demonstrates several key strengths and limitations that inform its scope and applicability. One major strength is using high spatial resolution pollutant predictions, achieved through universal kriging over census block centroids, which enables precise characterization of exposure patterns across geographic areas while incorporating the land use covariates. The integration of sociodemographic variables specific to the year monitoring was conducted further enhances the analysis, offering a robust framework to assess environmental justice implications and highlight disparities in pollutant exposure. Additionally, using simplified models increases the accessibility and reproducibility of the methodology, making it well-suited for policy-oriented applications.

The sociodemographic variables used in our analysis—language, race, and the percentage of individuals living above or below the federal poverty level (FPL)—offer both strengths and limitations. While these variables provide valuable insights into potential disparities in environmental exposures, there are notable weaknesses in their applicability. For instance, using the percentage of individuals below the FPL may not fully capture economic vulnerability in high-cost-of-living areas like ours. A more appropriate measure would have been 150% or 200% of the FPL, but such data were unavailable for our study. Similarly, the use of census tract racial and ethnic composition, while informative, is not the most meaningful metric for understanding systemic inequities; however, it was the best available data for our purposes. Despite these limitations, these variables still allow for a preliminary assessment of how environmental exposures may disproportionately affect marginalized populations.

However, the study has several limitations that should be acknowledged. The exclusion of broader PM2.5 sources and protective land-use factors restricts the generalizability of the findings to other contexts or regions. The sociodemographic metrics used, such as federal poverty level thresholds and racial or ethnic percentages, may oversimplify the complexities of social dynamics and their interactions with environmental exposures. Furthermore, reliance on a single year of averaged monitoring data limits the ability to capture temporal variability in pollutant concentrations, potentially affecting the robustness of the exposure estimates over time. Ideally, we would have used all 29 observations from each stop location, which allows for finer temporal resolution and a wider range of measurements. Due to our computational constraints, we were not able to do so, as attempting to run the universal kriging model on the full data crashed our server repeatedly. If we had been able to use this data, we could have examined factors relevant to air pollution variability, such as seasons. Finally, the authors of the original mobile monitoring study noted that the study area’s generally low PM2.5 concentrations produced noisy readings near the nephelometers’ limit of detection, thus yielding unstable measurements (Bramble et al., 2023). Further study could obtain higher quality PM2.5 measurements. These limitations suggest areas for future refinement to enhance the comprehensiveness of the analysis.

# Author Contribution Statement

M.C.E. performed linear regressions, contributed to results tables, and wrote and contributed to the background, methods, results, and discussion sections. C.M. conducted data cleaning, UK predictions and maps, descriptive statistics of demographics, UK cross-validation, merged predictions with demographic variables, created tables, and contributed to the methods, results, and discussion sections. S.M. cleaned and merged data, linear regression analyses of predicted NO2 and its association with race, language diversity, and poverty, created descriptive maps on the census tract level, and contributed to the introduction, methods, results, and discussion sections. J.R.G. was responsible for data cleaning and merging, analyzing predicted PM2.5 and poverty, NO2 and poverty, conducting linear regressions, creating corresponding maps, and contributing to the methods, results, and discussion sections. K.T. was responsible for data cleaning, mapping study area pollutant concentrations, performing linear regressions on pollutants and demographic variables, developing results tables, and contributing to the results and discussion sections.  All authors contributed equally to selecting covariates, reviewing and critiquing the content, and preparing the final manuscript. Data cleaning was carried out by C.M., J.R.G., K.T., M.C.E., and S.M. Figures and tables were developed collaboratively. K.T. and C.M. did the final referencing and formatting.

# Acknowledgments

We thank Dr. Lianne Sheppard and Dr. Magali Blanco for their guidance, feedback, and support throughout this past quarter. We also want to thank Brian High from DEOHS IT for his technical expertise and assistance, which were instrumental in this work.

# Appendix 1: Supplementary Results

## Map of Study Area Stop Concentrations Using Stop Data

```{r study.area.stoplevel.map}
#---- Stop data map (put in Appendix) ----
# Add NO2 data with additional map elements
no2_map_stop <- g + 
  geom_sf(data = stop_for_preds %>% filter(variable == "no2"), aes(color = mean_value)) + 
  scale_color_viridis_c() + 
  theme_void() +  
  theme(
    panel.border = element_rect(color = "black", fill = NA, size = 1),
     plot.title = element_text(hjust = 0.5)
  ) + 
  ggspatial::annotation_scale(location = "bl", width_hint = 0.3, unit_category = "imperial") +
  ggspatial::annotation_north_arrow(location = "tr", which_north = "true", style = north_arrow_fancy_orienteering) +  
  labs(col="NO2 (ppb)", title="NO2"
       )

# Add PM2.5 data with additional map elements, restricting scale to 40 and below
pm25_map_stop <- g + 
  geom_sf(data = stop_for_preds %>% filter(variable == "neph_bscat" & mean_value<40), aes(color = mean_value)) + 
  scale_color_viridis_c() +
  theme_void() +  
  theme(
    panel.border = element_rect(color = "black", fill = NA, size = 1),
    plot.title = element_text(hjust = 0.5)
  ) + 
  ggspatial::annotation_scale(location = "bl", width_hint = 0.3, unit_category = "imperial") +
  ggspatial::annotation_north_arrow(location = "tr", which_north = "true", style = north_arrow_fancy_orienteering) +  
  labs(col="PM2.5 (ug/m3)", title="PM2.5"
       )

no2_map_stop + pm25_map_stop + plot_annotation(title = 'Map of Study Area Stop Concentrations',
  #subtitle = 'NO2 (left) and PM2.5 (right)',
  caption = 'Both pollutants are presented on the native scale. \n NO2 is in ppb and PM2.5 is in ug/m3. This map captures 8638 individual\n stops over 304 locations.',
  theme = theme(plot.title = element_text(face = "bold", hjust = 0.5),
                plot.subtitle=element_text(hjust=0.5),
                plot.caption=element_text(hjust=0.5)))
```

## NO2 Variograms and UK Predictions

When attempting to fit a variogram using a data set with all 29 pollutant measurements at each stop location, the variogram appeared as though there was not an expected relationship between distance and semi-variance. We suppose this was due to the multiple observations at each stop location rendering semi-variance values based on distances between measurements at the same location, which would be zero, and the inability of our variogram function to handle time-series data. Additionally, when we attempted to run the UK model based on this variogram, it either crashed the server or never finished running, even after leaving the model running for over an hour.

```{r variogram.plots.no2.appendix}
# ggplot(vgm_no2_annual, aes(x = dist, y=gamma)) + 
#   geom_point(alpha=0.1) + 
#   labs(x="Distance (meters)",
#        title="Variogram Cloud Using Annual Mean Concentration: NO2")
# 
# # Binned Variogram with annual data
# plot(variogram(log_value ~ pop10_s05000 + lu_industrial_p03000 + log_m_to_a1 + log_m_to_a2 + log_m_to_a3 + log_m_to_coast + log_m_to_l_airp + log_m_to_comm, annual_for_preds %>% filter(variable == "no2")), main="Binned Variogram with Annual Concentration Data: NO2")
# 
# # Binned Variogram with Point Counts
# plot(variogram(log_value ~ pop10_s05000 + lu_industrial_p03000 + log_m_to_a1 + log_m_to_a2 + log_m_to_a3 + log_m_to_coast + log_m_to_l_airp + log_m_to_comm, annual_for_preds %>% filter(variable == "no2")), pl = TRUE, main="Binned Variogram with Annual Concentration Data with Point Counts: NO2")
# 
# # Semi-variogram cloud with smoothed curve
# ggplot(data = vgm_no2_annual, aes(x = dist, y = gamma)) +
#   geom_point(shape = 1, alpha = 0.6) +
#   geom_smooth(se = FALSE, color = "red", linetype = "solid",
#               # making span > 0.75 (default) makes this less wiggly so we can better see the general trend 
#               method = "loess", 
#               span = .8
#               ) +
#   labs(x = "Distance (meters)", 
#        y = "Semi-variance",
#        title = "Semi-variogram Cloud with Smoothed Curve: NO2") +
#   theme_bw() +
#   theme(legend.position = "none")

plot(v_annual, v_annual.fit, main="Empirical Variogram with Fitted Model Overlaid: NO2")

v_annual.fit
m_annual.uk
```

```{r grid.UK.preds.logNO2}
# Plot UK predictions 
# pl3 <- plot(ln.no2.kr["var1.pred"], main = "UK Prediction of Log(NO2) on Grid")
# 
# # Plot UK prediction standard errors 
# pl4 <- plot(ln.no2.kr["se"], main = "UK Prediction Error NO2 (Standard Error) on Grid")

# Plot UK predictions
#pl3 <- plot(ln.NO2.block.kr["var1.pred"], main = "UK Prediction of Log(PM2.5) on Census Block Centroids")

# Plot UK prediction standard errors
pl4 <- plot(ln.NO2.block.kr["se"], main = "UK Prediction Error PM2.5\n (Standard Error) on Census Block Centroids")
```

## PM2.5 Variograms and UK Predictions

```{r variogram.plots.pm25.appendix}
#plot(v.uk.pm25, main="Estimated Variogram for log(PM2.5)")

plot(v.uk.pm25, model = m.uk.pm25, main="Estimated Variogram for log(PM2.5) with Fitted Variogram")

# Display the selected variogram model parameters
m.uk.pm25
```

```{r UK.preds.logPM25}
# Plot UK predictions grid
# pl3 <- plot(ln.PM25.kr.grid["var1.pred"], main = "UK Prediction of Log(PM2.5) on Grid")
# 
# # Plot UK prediction standard errors grid
# pl4 <- plot(ln.PM25.kr.grid["se"], main = "UK Prediction Error PM2.5 (Standard Error) on Grid")

# Plot UK predictions block
#pl3 <- plot(ln.PM25.kr["var1.pred"], main = "UK Prediction of Log(PM2.5) on Census Block Centroids")

# Plot UK prediction standard errors block
pl4 <- plot(ln.PM25.kr["se"], main = "UK Prediction Error PM2.5 (Standard Error)\n on Census Block Centroids")
```

## Univariate regression models

```{r univar. results}

# Formatted table for regression results NO2
no2_univar_res %>%
  select(term, intercept, estimate, std.error, statistic, p.value, conf.low, conf.high) %>% 
  mutate(
    Term = case_when(
      term == "Percent_Below_Poverty" ~ "% Below Poverty",
      term == "p_engl_only" ~ "% English Language Only",
      term == "p_lang_other" ~ "% Other Language",
      term == "p_spanish" ~ "% Spanish Language",
      term == "p_White" ~ "% White",
      term == "p_BlackAA" ~ "% Black or African American",
      term == "p_AIAN" ~ "% American Indian or Alaska Native",
      term == "p_Asian" ~ "% Asian",
      term == "p_HPI" ~ "% Hawaiian or Pacific Islander",
      term == "p_Hispanic" ~ "% Hispanic or Latino",
      TRUE ~ term 
    )
  ) %>%
  select(Term, intercept, estimate, std.error, statistic, p.value, conf.low, conf.high) %>%
  rename(
    Estimate = estimate,
    Intercept = intercept,
    `Std. Error` = std.error,
    `t-value` = statistic,
    `P-value` = p.value,
    `95%CI Low` = conf.low,
    `95%CI High` = conf.high
  ) %>% 
  kable(
    caption = "Table: Univariate Regression for Association Results for NO2 Model. Response variable was log(NO2), and all results have been exponentiated. Each row represents a separate univariate regression model, with the Term as the predictor variable.",
    digits = 3, 
    col.names = c("Term", "Intercept", "Estimate", "Std. Error", "t-value", "P-value", "95% CI Low", "95% CI High")
  ) %>%
  kable_styling(
    full_width = FALSE, 
    bootstrap_options = c("striped", "hover", "condensed")
  )

# Formatted table for regression results
pm_univar_res %>%
  select(term, intercept, estimate, std.error, statistic, p.value, conf.low, conf.high) %>% 
  mutate(
    Term = case_when(
      term == "Percent_Below_Poverty" ~ "% Below Poverty",
      term == "p_engl_only" ~ "% English Language Only",
      term == "p_lang_other" ~ "% Other Language",
      term == "p_spanish" ~ "% Spanish Language",
      term == "p_White" ~ "% White",
      term == "p_BlackAA" ~ "% Black or African American",
      term == "p_AIAN" ~ "% American Indian or Alaska Native",
      term == "p_Asian" ~ "% Asian",
      term == "p_HPI" ~ "% Hawaiian or Pacific Islander",
      term == "p_Hispanic" ~ "% Hispanic or Latino",
      TRUE ~ term 
    )
  ) %>%
  select(Term, intercept, estimate, std.error, statistic, p.value, conf.low, conf.high) %>%
  rename(
    Estimate = estimate,
    Intercept = intercept,
    `Std. Error` = std.error,
    `t-value` = statistic,
    `P-value` = p.value,
    `95%CI Low` = conf.low,
    `95%CI High` = conf.high
  ) %>% 
  kable(
    caption = "Table: Univariate Regression for Association Results for PM2.5 Model. Response variable was log(PM2.5), and all results have been exponentiated. Each row represents a separate univariate regression model, with the Term as the predictor variable.",
    digits = 3, 
    col.names = c("Term", "Intercept", "Estimate", "Std. Error", "t-value", "P-value", "95% CI Low", "95% CI High")
  ) %>%
  kable_styling(
    full_width = FALSE, 
    bootstrap_options = c("striped", "hover", "condensed")
  )
```

## Map of linguistic diversity for study area

```{r}
# For adding OpenStreetMap tiles

# Define the language variables and their readable names
selected_language_vars <- c(
  "p_engl_only",
  "p_lang_other"
)

readable_language_names <- c(
  "English Only",
  "Language Other Than English"
)

# Ensure CRS is consistent for mapping
full_data_w_preds_perc_spatial <- st_transform(full_data_w_preds_perc_spatial, crs = 4326)

# Pivot dataset to long format for mapping language groups
full_data_w_preds_perc_spatial <- full_data_w_preds_perc_spatial %>%
  select(geometry, all_of(selected_language_vars)) %>%
  pivot_longer(
    cols = all_of(selected_language_vars),
    names_to = "Language",
    values_to = "Percentage"
  ) %>%
  mutate(
    Language = recode(Language, 
                      "English_only" = "English Only",
                      "Language_other_than_English" = "Language Other Than English")
  )

# Create the map with OpenStreetMap as the background
ggplot() +
  annotation_map_tile(type = "osm", zoom = 10) +  # Add OpenStreetMap tiles as the base layer
  geom_sf(
    data = full_data_w_preds_perc_spatial,
    aes(fill = Percentage, geometry = geometry),
    color = NA,
    alpha = 0.8
  ) +
  facet_wrap(~ Language, ncol = 2) +  # Facet by language group
  scale_fill_viridis_c(
    name = "Percentage",
    option = "plasma",
    na.value = "grey90"
  ) +
  labs(
    title = "Spatial Distribution of Language Diversity by Census Tract",
    caption = "Data Sources: ACS, OpenStreetMap",
    x = "Longitude",
    y = "Latitude"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 14, face = "bold", hjust = 0.5),
    plot.caption = element_text(size = 10, hjust = 1),
    legend.title = element_text(size = 12),
    legend.text = element_text(size = 10),
    legend.position = "right",
    panel.background = element_rect(fill = "transparent", color = NA)
  )
```

# References

Allen, R. W., Davies, H., Cohen, M. A., Mallach, G., Kaufman, J. D., & Adar, S. D. (2009). The spatial relationship between traffic-generated air pollution and noise in 2 US cities. Environmental Research, 109(3), 334–342. <https://doi.org/10.1016/j.envres.2008.12.006>

Blanco, M. N., Gassett, A., Gould, T., Doubleday, A., Slager, D. L., Austin, E., Seto, E., Larson, T. V., Marshall, J. D., & Sheppard, L. (2022). Characterization of annual average traffic-related air pollution concentrations in the greater Seattle area from a year-long mobile monitoring campaign. Environmental Science & Technology, 56(16), 11460–11472. <https://doi.org/10.1021/acs.est.2c01077>

Blanco, M., & Sheppard, L. (2024). ACT-AP Mobile Monitoring [Dataset]. Zenodo. <https://doi.org/10.5281/ZENODO.13761282>

Bramble, K., Blanco, M. N., Doubleday, A., Gassett, A. J., Hajat, A., Marshall, J. D., & Sheppard, L. (2023). Exposure disparities by income, race and ethnicity, and historic redlining grade in the greater Seattle area for ultrafine particles and other air pollutants. Environmental Health Perspectives, 131(7), 77004. <https://doi.org/10.1289/EHP11662>

Chi, G. C., Hajat, A., Bird, C. E., Cullen, M. R., Griffin, B. A., Miller, K. A., Shih, R. A., Stefanick, M. L., Vedal, S., Whitsel, E. A., & Kaufman, J. D. (2016). Individual and neighborhood socioeconomic status and the association between air pollution and cardiovascular disease. Environmental Health Perspectives, 124(12), 1840–1847. <https://doi.org/10.1289/EHP199>

Clark, L. P., Millet, D. B., & Marshall, J. D. (2017). Changes in transportation-related air pollution exposures by race-ethnicity and socioeconomic status: Outdoor nitrogen dioxide in the United States in 2000 and 2010. Environmental Health Perspectives, 125(9), 097012. <https://doi.org/10.1289/EHP959>

Clean Air Act Amendments of 1990, 1630, Senate 101st Congress (1990). <https://www.congress.gov/bill/101st-congress/senate-bill/1630/text>

Gregory, J. (n.d.). Seattle’s Race and Segregation Story in Maps 1920-2020 - Seattle Civil Rights and Labor History Project. University of Washington. Retrieved December 8, 2024, from <https://depts.washington.edu/civilr/segregation_maps.htm>

Groover, H. (2024, June 28). As WA housing costs climb, incomes aren’t keeping up. The Seattle Times. <https://www.seattletimes.com/business/real-estate/as-wa-housing-costs-climb-incomes-arent-keeping-up/>

Hong, G., & Jee, Y.-K. (2020). Special issue on ultrafine particles: where are they from and how do they affect us? Experimental & Molecular Medicine, 52(3), 309–310. <https://doi.org/10.1038/s12276-020-0395-z>

Loopmans, M., Smits, L., & Kenis, A. (2022). Rethinking environmental justice: capability building, public knowledge and the struggle against traffic-related air pollution. Environment and Planning C Politics and Space, 40(3), 705–723. <https://doi.org/10.1177/23996544211042876>

McDuffie, E. E., Martin, R. V., Spadaro, J. V., Burnett, R., Smith, S. J., O’Rourke, P., Hammer, M. S., van Donkelaar, A., Bindle, L., Shah, V., Jaeglé, L., Luo, G., Yu, F., Adeniran, J. A., Lin, J., & Brauer, M. (2021). Source sector and fuel contributions to ambient PM2.5 and attributable mortality across multiple spatial scales. Nature Communications, 12(1), 3594. <https://doi.org/10.1038/s41467-021-23853-y>

Mercer, L. D., Szpiro, A. A., Sheppard, L., Lindström, J., Adar, S. D., Allen, R. W., Avol, E. L., Oron, A. P., Larson, T., Liu, L.-J. S., & Kaufman, J. D. (2011). Comparing universal kriging and land-use regression for predicting concentrations of gaseous oxides of nitrogen (NOx) for the Multi-Ethnic Study of Atherosclerosis and Air Pollution (MESA Air). Atmospheric Environment (Oxford, England: 1994), 45(26), 4412–4420. <https://doi.org/10.1016/j.atmosenv.2011.05.043>

NAAQS Table. (2024, February 7). EPA. <https://www.epa.gov/criteria-air-pollutants/naaqs-table>

Nitrogen Dioxide (NO2). (2016, July 6). EPA. <https://www.epa.gov/no2-pollution/basic-information-about-no2>

Particulate Matter (PM). (2016, April 26). EPA. <https://www.epa.gov/pm-pollution/health-and-environmental-effects-particulate-matter-pm>

Rubio, R., Grineski, S., & Collins, T. (2021). Children’s exposure to vehicular air pollution in the United States: environmental injustices at the intersection of race/ethnicity and language. Environmental Sociology, 7(3), 187–199. <https://doi.org/10.1080/23251042.2021.1878574>

U.S. Census Bureau. (n.d.). Census Bureau Data. Retrieved December 8, 2024, from <https://data.census.gov/>

U.S. Environmental Protection Agency. (2013, March 20). <https://www.epa.gov/home>

# Appendix 2

## Session information

```{r session.info}
#-----session information-----

# print R session information
sessionInfo()

```

## Embedded code

```{r code.appendix, ref.label = knitr::all_labels(), echo = TRUE, eval = FALSE, , include=TRUE}
#-----code appendix-----
```

## Functions defined

```{r functions, eval = TRUE}
#-----functions-----

# Show the names of all functions defined in the .Rmd
# (e.g. loaded in the environment)
lsf.str()

# Show the definitions of all functions loaded into the current environment  
lapply(c(lsf.str()), getAnywhere)
```
